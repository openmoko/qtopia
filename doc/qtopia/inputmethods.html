<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- /home/warwick/qtopia/1.6/tmp24407/qtopia/doc/inputmethods.doc:1 -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css"><!--
h3.fn,span.fn { margin-left: 1cm; text-indent: -1cm; }
a:link { color: #004faf; text-decoration: none }
a:visited { color: #672967; text-decoration: none }
body { background: #ffffff; color: black; }
--></style>
</head>
<body>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr bgcolor="black"><td>
|<a href="classes.html">
<font color="white">Classes</font></a>
<font color="white">|</font>
<a href="functions.html"><font color="white">Functions</font></a>
<font color="white">|</font>
<a href="../qt/index.html"><font color="white">Qt API</font></a>
</td>
<td align="right"><a href="../index.html"><font color="white"><i>Qtopia Documentation</i></font></a></td>
<td align="right" valign="center"><img src="logo32.png" align="right" width="64" height="32" border="0"></td></tr></table>
<p> 
<p> <h2> Input Methods
</h2>
<a name="1"></a><p> Input methods must supply a QWidget that will be shown above the task bar
and emit a signal when a key is pressed:
<p> <pre>
#include &lt;qwidget.h&gt;

class SimpleInputMethod : public QWidget
{
    Q_OBJECT
public:
    SimpleInputMethod( QWidget *parent, const char *name, WFlags f );

signals:
    void keyPress( ushort unicode, ushort keycode, ushort modifiers, bool press, bool repeat )
};
</pre>
 
<p> The parameters of the keyPress signal are:
<p> <center><table cellpadding="4" cellspacing="2" border="0">
<tr bgcolor="#a2c511"> <th valign="top">Parameter <th valign="top">Notes
<tr bgcolor="#f0f0f0"> 
<td valign="top">unicode
<td valign="top">The unicode value of the character, or 0xFFFF if it is a non-printing key.
<tr bgcolor="#d0d0d0"> 
<td valign="top">keycode
<td valign="top">The key code as specified in <tt>qnamespace.h</tt>
<tr bgcolor="#f0f0f0"> 
<td valign="top">modifiers
<td valign="top">A combination of zero or more of the following OR'ed together:
Qt::ShiftButton, Qt::ControlButton and Qt::AltButton 
<tr bgcolor="#d0d0d0"> 
<td valign="top">press
<td valign="top">TRUE for a key press, FALSE for a key release.
<tr bgcolor="#f0f0f0"> 
<td valign="top">repeat
<td valign="top">TRUE if this is a repeating keypress.
</table></center>
<p> Input methods may be added to Qtopia via plugins. In order to write an
input method plugin you must create an interface to your input method by
deriving from the <a href="inputmethodinterface.html">InputMethodInterface</a> class and implementing the pure
virtual functions.
<p> To make an input method plugin the following implementation is required:
<p> <pre>
#include &lt;qpe/inputmethodinterface.h&gt;

class SimpleInputMethodImpl : public <a href="inputmethodinterface.html">InputMethodInterface</a>
{
public:
    SimpleInputMethodImpl();
    virtual ~SimpleInputMethodImpl();

#ifndef QT_NO_COMPONENT
    QRESULT queryInterface( const <a href="quuid.html">QUuid</a>&amp;, QUnknownInterface** );
    Q_REFCOUNT
#endif

    virtual QWidget *inputMethod( QWidget *parent, Qt::WFlags f );
    virtual void resetState();
    virtual QPixmap *icon();
    virtual QString name();
    virtual void onKeyPress( QObject *receiver, const char *slot );

private:
    SimpleInputMethod *input;
    QPixmap *icn;
    ulong ref;
};
</pre>
 
<p> The constructor and destructor are very simple:
<p> <pre>
SimpleInputMethodImpl::SimpleInputMethodImpl()
    : input(0), icn(0), ref(0)
{
}

SimpleInputMethodImpl::~SimpleInputMethodImpl()
{
    delete input;
    delete icn;
}
</pre>
 
<p> The queryInterface() function can be implemented using the
following boilerplate code:
<p> <pre>
QRESULT SimpleInputMethodImpl::queryInterface( const <a href="quuid.html">QUuid</a> &amp;uuid, QUnknownInterface **iface )
{
    *iface = 0;
    if ( uuid == IID_QUnknown )
        *iface = this;
    else if ( uuid == IID_InputMethod )
        *iface = this;
    else
        return QS_FALSE;

    (*iface)-&gt;addRef();
    return QS_OK;
}
</pre>
 
<p> The inputMethod() function returns the input method widget. This
widget will be display just above the task bar when the user needs to input
text. You should always return the same widget if this function is called
multiple times.
<p> <pre>
QWidget *SimpleInputMethodImpl::inputMethod( QWidget *parent, Qt::WFlags f )
{
    if ( !input )
        input = new SimpleInputMethod( parent, "SimpleInput", f );
    return input;
}
</pre>
 
<p> The resetState() function should return the input method to its default
state.
<p> The name() function returns the name of the input method. This will
be displayed in the popup list of available input methods.
<p> <pre>
QString SimpleInputMethodImpl::name()
{
    return qApp-&gt;translate( "InputMethods", "SimpleInput" );
}
</pre>
 
<p> The name() function returns the icon for the input method. This will
be displayed in the taskbar when the input method is selected.
<p> <pre>
QPixmap *SimpleInputMethodImpl::icon()
{
    if ( !icn )
        icn = new QPixmap( your pixmap );
    return icn;
}
</pre>
 
<p> The onKeyPress() function must connect the supplied slot to the signal
that is emitted when a key press is generated.
<p> The following code will connect the signal to the supplied slot:
<p> <pre>
void SimpleInputMethodImpl::onKeyPress( QObject *receiver, const char *slot )
{
    if ( input )
        QObject::connect( input, SIGNAL(keyPress(ushort,ushort,ushort,bool,bool)), receiver, slot );
}
</pre>
 
<p> You must also create an instance of the input method plugin using the
following boilerplate code:
<p> <pre>
Q_EXPORT_INTERFACE()
{
    Q_CREATE_INSTANCE( SimpleInputMethodImpl )
}
</pre>
 
<p> The plugin must be compiled as a shared library and placed in the <tt>$QPEDIR/plugins/imputmethods</tt> directory. The following <tt>tmake</tt> project
file will create a suitable Makefile:
<p> <pre>
TEMPLATE     = lib
CONFIG      += qt warn_on release
HEADERS      = simpleinputmethod.h \
               simpleinputmethodimpl.h
SOURCES      = simpleinputmethod.cpp \
               simpleinputmethodimpl.cpp
TARGET       = simpleinputmethod
DESTDIR      = $(QPEDIR)/plugins/inputmethods
INCLUDEPATH += $(QPEDIR)/include
LIBS        += -lqpe
VERSION      = 1.0.0
</pre>
 
<p> Examples of Qtopia input methods can be found in the <tt>inputmethods/</tt>
directory of the Qtopia source code.
<p> 
<!-- eof -->
<p><address><hr><div align=center>
<table width=100% cellspacing=0 border=0><tr>
<td>Copyright &copy; 2001-2002 Trolltech<td><a href="http://www.trolltech.com/trademarks.html">Trademarks</a>
<td align=right><div align=right>Qtopia version 1.6.0</div>
</table></div></address></body>
</html>
