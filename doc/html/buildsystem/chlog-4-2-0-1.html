<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Changes for 4.2&#x2e;0</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="reference.html"><font color="#004faf">Reference</font></a>&nbsp;&middot; <a href="userguide.html"><font color="#004faf">User Guide</font></a>&nbsp;&middot; <a href="internals.html"><font color="#004faf">Internals</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">Changes for 4.2&#x2e;0<br /><span class="subtitle"></span>
</h1>
<a name="overview"></a>
<h2>Overview</h2>
<p>This page describes changes to the 4.2&#x2e;0 build system.</p>
<ul>
<li>Environment variables are no longer required or honoured.</li>
<li>The image, prefix and SDK location are now explicitly specified.</li>
<li>The default image is now located in <tt>&lt;build&gt;/image</tt> instead of <tt>&lt;build&gt;/image/opt/Qtopia</tt>.</li>
<li>The RPATH is implcitly set to <tt>&lt;prefix&gt;/lib</tt> unless you pass -no-rpath.</li>
<li>Host libs go in <tt>&lt;build&gt;/lib/host</tt> to avoid clashes with target libs.</li>
<li>Big syntax changes in qmake (whitespace and quoting are very different).</li>
<li>Classic includes are not located at <tt>&lt;build&gt;include/classic</tt> and Qt-style includes are located at <tt>&lt;build&gt;/include</tt>.</li>
<li>New <a href="hint-themecfg-1.html">hint=themecfg</a> for translatable strings in themes.</li>
<li>New library qtopiabase that sits between Qtopia and Qtopia Core, resolving some dependency issues.</li>
<li>Only 1 icon size is used.</li>
<li>New <a href="hint-non-qt-headers-1.html">hint=non_qt_headers</a> which is required due to the switch to using Qt-style headers by default.</li>
<li>.desktop files are no longer installed. Instead, their contents are put into the PREFIX database.</li>
<li>New <a href="hint-script-1.html">hint=script</a> for scripts that need to know where the PREFIX is.</li>
<li><a href="conf-link-test-1.html">link_test</a> can operate on both Qtopia and Qtopia Core plugins (including quicklaunched apps). It's currently opt-in.</li>
<li>qtopiacore projects (libraries and plugins) are installed from their directories instead of src/qt.</li>
</ul>
<a name="image-prefix-and-sdk-location"></a>
<h3>image, prefix and SDK location</h3>
<p>Qtopia 4.1 used -prefix in the same way that Qt uses it. It carried a double meaning, specifying both the image and the prefix (which is hardcoded into libQtCore.so). To work around the fact that you don't usualy want these locations to be the same on an embedded system, you could override the image location by running <tt>make install PREFIX=/somewhere/else</tt>.</p>
<p>When building an SDK, you also had to override PREFIX so that the binaries would end up in the correct location. A significant drawback to this approach is that the build tree must have a longer path than the SDK location (because the binaries are patched to use the SDK location).</p>
<p>To reduce confusion and to enable a smoother install process, the three locations are now specified explicitly to configure. The switches are -image, -prefix and -sdk. Specifying -image will give the same behaviour as -prefix in 4.1 because the prefix location defaults to the image location.</p>
<p>If the -sdk parameter is not passed (or you pass -sdk <tt>&lt;build&gt;</tt>) then make sdk does not work. This is because you cannot change the location an SDK will be installed to and you cannot install an SDK to the build tree. You can use the build tree in the same way that you would use an SDK. When you do pass -sdk to configure, <tt>make sdk</tt> is implcitly run when you run <tt>make install</tt> because the host binaries have <tt>SDK/qtopiacore/host/lib</tt> added to their RPATH and they will fail to find their libraries if the SDK has not been created.</p>
<p>It is still possible to override the image location when you run make install. You must now run <tt>make install IMAGE=/somewhere/else</tt>. This facility remains becase it is required by <tt>make packages</tt>.</p>
<p>For reference, the following table lists the locations for the SDK, IMAGE and PREFIX in a variety of situations.</p>
<p><table align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>command</th><th>SDK</th><th>IMAGE</th><th>PREFIX</th></tr></thead>
<tr valign="top" class="odd"><td colspan="4"><b>Qtopia 4.1</b></td></tr>
<tr valign="top" class="even"><td><tt>configure</tt></td><td>&lt;build&gt;</td><td>&lt;build&gt;/image/opt/Qtopia</td><td>/opt/Qtopia</td></tr>
<tr valign="top" class="odd"><td><tt>configure -prefix /Qtopia</tt></td><td>&lt;build&gt;</td><td>/Qtopia</td><td>/Qtopia</td></tr>
<tr valign="top" class="even"><td><tt>make install PREFIX=/foo</tt></td><td><i>unchanged</i></td><td>/foo</td><td><i>unchanged</i></td></tr>
<tr valign="top" class="odd"><td><tt>make sdk PREFIX=/bar</tt></td><td>/bar</td><td><i>unchanged</i></td><td><i>unchanged</i></td></tr>
<tr valign="top" class="even"><td colspan="4"><b>Qtopia 4.2</b></td></tr>
<tr valign="top" class="odd"><td><tt>configure</tt></td><td>&lt;build&gt;</td><td>&lt;build&gt;/image</td><td><i>IMAGE</i> (&lt;build&gt;/image)</td></tr>
<tr valign="top" class="even"><td><tt>configure -prefix /Qtopia</tt></td><td>&lt;build&gt;</td><td>&lt;build&gt;/image</td><td>/Qtopia</td></tr>
<tr valign="top" class="odd"><td><tt>configure -image /Qtopia</tt></td><td>&lt;build&gt;</td><td>/Qtopia</td><td><i>IMAGE</i> (/Qtopia)</td></tr>
<tr valign="top" class="even"><td><tt>configure -sdk /sdk -image /image -prefix /prefix</tt></td><td>/sdk</td><td>/image</td><td>/prefix</td></tr>
<tr valign="top" class="odd"><td><tt>make install IMAGE=/foo</tt></td><td><i>unchanged</i></td><td>/foo</td><td><i>unchanged</i></td></tr>
</table></p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2007 Trolltech</td>
<td align="right">Qtopia Build System Documentation</td>
</tr></table></div></address></body>
</html>
