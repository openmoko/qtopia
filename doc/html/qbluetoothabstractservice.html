<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>QBluetoothAbstractService Class Reference</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">QBluetoothAbstractService Class Reference</h1>
<p>The QBluetoothAbstractService class is an abstract class for running a Bluetooth service within the Qtopia Bluetooth framework. <a href="#details">More...</a></p>
<pre>    #include &lt;QBluetoothAbstractService&gt;</pre><p>Inherits <a href="qabstractipcinterfacegroup.html">QAbstractIpcInterfaceGroup</a>.</p>
<ul>
<li><a href="qbluetoothabstractservice-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="public-functions"></a>
<h3>Public Functions</h3>
<ul>
<li><div class="fn"/><b><a href="qbluetoothabstractservice.html#QBluetoothAbstractService">QBluetoothAbstractService</a></b> ( const QString &amp; <i>name</i>, QObject * <i>parent</i> = 0 )</li>
<li><div class="fn"/>virtual <b><a href="qbluetoothabstractservice.html#dtor.QBluetoothAbstractService">~QBluetoothAbstractService</a></b> ()</li>
<li><div class="fn"/>virtual void <b><a href="qbluetoothabstractservice.html#initialize">initialize</a></b> ()</li>
<li><div class="fn"/>virtual void <b><a href="qbluetoothabstractservice.html#setSecurityOptions">setSecurityOptions</a></b> ( QBluetooth::SecurityOptions <i>options</i> ) = 0</li>
<li><div class="fn"/>virtual void <b><a href="qbluetoothabstractservice.html#start">start</a></b> ( int <i>channel</i> ) = 0</li>
<li><div class="fn"/>virtual void <b><a href="qbluetoothabstractservice.html#stop">stop</a></b> () = 0</li>
<li><div class="fn"/>virtual QString <b><a href="qbluetoothabstractservice.html#translatableDisplayName">translatableDisplayName</a></b> () const = 0</li>
</ul>
<ul>
<li><div class="fn"/>4 public functions inherited from <a href="qabstractipcinterfacegroup.html#public-functions">QAbstractIpcInterfaceGroup</a></li>
<li><div class="fn"/>37 public functions inherited from <a href="qobject.html#public-functions">QObject</a></li>
</ul>
<a name="signals"></a>
<h3>Signals</h3>
<ul>
<li><div class="fn"/>void <b><a href="qbluetoothabstractservice.html#error">error</a></b> ( QBluetooth::ServiceError <i>error</i>, const QString &amp; <i>errorDesc</i> )</li>
<li><div class="fn"/>void <b><a href="qbluetoothabstractservice.html#started">started</a></b> ( QBluetooth::ServiceError <i>error</i>, const QString &amp; <i>errorDesc</i> )</li>
<li><div class="fn"/>void <b><a href="qbluetoothabstractservice.html#stopped">stopped</a></b> ( QBluetooth::ServiceError <i>error</i>, const QString &amp; <i>errorDesc</i> )</li>
</ul>
<ul>
<li><div class="fn"/>1 signal inherited from <a href="qobject.html#signals">QObject</a></li>
</ul>
<a name="protected-functions"></a>
<h3>Protected Functions</h3>
<ul>
<li><div class="fn"/>QString <b><a href="qbluetoothabstractservice.html#sdpError">sdpError</a></b> ()</li>
<li><div class="fn"/>bool <b><a href="qbluetoothabstractservice.html#sdpRegister">sdpRegister</a></b> ( const QBluetoothAddress &amp; <i>local</i>, QBluetooth::SDPProfile <i>profile</i>, int <i>channel</i> )</li>
<li><div class="fn"/>bool <b><a href="qbluetoothabstractservice.html#sdpUnregister">sdpUnregister</a></b> ()</li>
</ul>
<ul>
<li><div class="fn"/>2 protected functions inherited from <a href="qabstractipcinterfacegroup.html#protected-functions">QAbstractIpcInterfaceGroup</a></li>
<li><div class="fn"/>8 protected functions inherited from <a href="qobject.html#protected-functions">QObject</a></li>
</ul>
<h3>Additional Inherited Members</h3>
<ul>
<li><div class="fn"/>1 property inherited from <a href="qobject.html#properties">QObject</a></li>
<li><div class="fn"/>1 public slot inherited from <a href="qobject.html#public-slots">QObject</a></li>
<li><div class="fn"/>1 public type inherited from <a href="qobject.html#public-variables">QObject</a></li>
<li><div class="fn"/>4 static public members inherited from <a href="qobject.html#static-public-members">QObject</a></li>
<li><div class="fn"/>2 protected variables inherited from <a href="qobject.html#protected-variables">QObject</a></li>
<li><div class="fn"/>1 static protected member inherited from <a href="qobject.html#static-protected-members">QObject</a></li>
</ul>
<a name="details"></a>
<hr />
<h2>Detailed Description</h2>
<p>The QBluetoothAbstractService class is an abstract class for running a Bluetooth service within the Qtopia Bluetooth framework.</p>
<p>The QBluetoothAbstractService class is an abstract class for handling the process of running a Bluetooth service within the Qtopia Bluetooth framework. Each subclass provides the specific implementation for running a particular Bluetooth service.</p>
<p>This allows a custom Bluetooth service to be registered and accessible as a system Bluetooth service. For example, a subclass's associated service will be displayed in the system Bluetooth settings panel, allowing end users to modify the service's settings.</p>
<p>The subclass should emit the provided signals as appropriate:</p>
<ul>
<li>emit <a href="qbluetoothabstractservice.html#started">started</a>() when the service has started, or an error has occured while starting the service</li>
<li>emit <a href="qbluetoothabstractservice.html#stopped">stopped</a>() when the service has stopped, or an error has occured while starting the service</li>
<li>emit <a href="qbluetoothabstractservice.html#error">error</a>() when a fatal error has occured while running the service</li>
</ul>
<p>(Note that a <tt>QBluetoothAbstractService</tt> is very different from a Bluetooth SDP service that is registered through the <a href="qsdp.html">QSDP</a> class. For example, <tt>QBluetoothAbstractService</tt> could be subclassed to create a <tt>ObjectPushService</tt> class, and when <a href="qbluetoothabstractservice.html#start">start</a>() is called, this subclass could advertise an Object Push SDP service (using the <a href="qbluetoothabstractservice.html#sdpRegister">sdpRegister</a>() function) and then start an Object Push server.)</p>
<p>Here is an example of creating a custom Bluetooth service using a class named <tt>MyBluetoothService</tt>. The service will advertise the Serial Port Profile, and we'll call the service &quot;MySerialPortService&quot;.</p>
<p>Firstly, the constructor:</p>
<pre>    MyBluetoothService::MyBluetoothService(QObject *parent = 0)
        : QBluetoothAbstractService(&quot;MySerialPortService&quot;, parent)
    {
        initialize();
    }</pre>
<p>This creates a service named &quot;MySerialPortService&quot;. This name must be unique among Qtopia Bluetooth services, as it is used internally to uniquely identify the service (for example, for storing information in the value space). The code above also calls <a href="qbluetoothabstractservice.html#initialize">initialize</a>() to perform the necessary set-up for internal components.</p>
<p>Then, we implement the <a href="qbluetoothabstractservice.html#start">start</a>() method:</p>
<pre>    void MyBluetoothService::start(int channel)
    {
        if (!startMyService()) {    <span class="comment">// call some method to start the service</span>
            emit started(QBluetooth::UnknownError,
                      tr(&quot;Unable to start MySerialPortService&quot;));
            return;
        }

        QBluetoothLocalDevice local;
        if (!sdpRegister(local.address(), QBluetooth::SerialPortProfile, channel)) {
            <span class="comment">// call some method to shut down the service</span>
            close();
            emit started(QBluetooth::SDPServerError,
                         tr(&quot;Error registering with SDP server&quot;));
            return;
        }

        <span class="comment">// service was successfully started</span>
        emit started(QBluetooth::NoError, QString());
    }</pre>
<p>The <a href="qbluetoothabstractservice.html#start">start</a>() method is called by Qtopia when the service should be started. Note how the example emits the <a href="qbluetoothabstractservice.html#started">started</a>() signal when the service fails to start, and also when it does start successfully. Also, it calls <a href="qbluetoothabstractservice.html#sdpRegister">sdpRegister</a>() to advertise the appropriate SDP service.</p>
<p>The class also needs to have a <a href="qbluetoothabstractservice.html#stop">stop</a>() method:</p>
<pre>    void MyBluetoothService::stop()
    {
        <span class="comment">// call some method to shut down the service</span>
        close();

        if (!sdpUnregister()) {
            emit stopped(QBluetooth::SDPServerError,
                         tr(&quot;Error unregistering from SDP server&quot;));
            return;
        }

        <span class="comment">// service was successfully stopped</span>
        emit stopped(QBluetooth::NoError, QString());
    }</pre>
<p>As with <a href="qbluetoothabstractservice.html#start">start</a>(), the <a href="qbluetoothabstractservice.html#stopped">stopped</a>() signal is emitted when the service is stopped successfully and also when it fails to stop.</p>
<p>To set the display name for the service, implement <a href="qbluetoothabstractservice.html#translatableDisplayName">translatableDisplayName</a>():</p>
<pre>    QString MyBluetoothService::translatableDisplayName() const
    {
        return tr(&quot;My Serial Port Service&quot;);
    }</pre>
<p>This string will be used, for example, to describe the service in the list of Bluetooth services in Qtopia's Bluetooth settings application.</p>
<p>Finally, the class will need to implement the <a href="qbluetoothabstractservice.html#setSecurityOptions">setSecurityOptions</a>() method to provide the ability to modify the security settings for the service.</p>
<hr />
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QBluetoothAbstractService"></a>QBluetoothAbstractService::QBluetoothAbstractService ( const <a href="qstring.html">QString</a> &amp; <i>name</i>, <a href="qobject.html">QObject</a> * <i>parent</i> = 0 )</h3>
<p>Construct a Bluetooth service. The <i>name</i> is a unique name that identifies the service. This name will also be used as the display name (e.g. in the BTSettings list of local services) unless <a href="qbluetoothabstractservice.html#translatableDisplayName">translatableDisplayName</a>() returns a different value. The <i>parent</i> is the <a href="qobject.html">QObject</a> parent for this service.</p>
<h3 class="fn"><a name="dtor.QBluetoothAbstractService"></a>QBluetoothAbstractService::~QBluetoothAbstractService ()&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Deconstructs a Bluetooth service.</p>
<h3 class="fn"><a name="error"></a>void QBluetoothAbstractService::error ( <a href="qbluetooth.html#ServiceError-enum">QBluetooth::ServiceError</a> <i>error</i>, const <a href="qstring.html">QString</a> &amp; <i>errorDesc</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This should must be emitted when the service has encountered a fatal error while running. The error details should be provided with an <i>error</i> identifier and <i>errorDesc</i> description.</p>
<h3 class="fn"><a name="initialize"></a>void QBluetoothAbstractService::initialize ()&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Initialize the service. This must be called to complete the initialization process.</p>
<p>If the service is being created for the first time, when this method is called, the service will automatically be told to start (i.e. <a href="qbluetoothabstractservice.html#start">start</a>() will be called). Otherwise, the service will only be started if it was still running when the system was last shut down.</p>
<p>Reimplemented from <a href="qabstractipcinterfacegroup.html#initialize">QAbstractIpcInterfaceGroup</a>.</p>
<h3 class="fn"><a name="sdpError"></a><a href="qstring.html">QString</a> QBluetoothAbstractService::sdpError ()&nbsp;&nbsp;<tt> [protected]</tt></h3>
<p>Returns a description of the last error that occured when calling <a href="qbluetoothabstractservice.html#sdpRegister">sdpRegister</a>() or <a href="qbluetoothabstractservice.html#sdpUnregister">sdpUnregister</a>() (i.e. if either of them returned <tt>false</tt>).</p>
<h3 class="fn"><a name="sdpRegister"></a>bool QBluetoothAbstractService::sdpRegister ( const <a href="qbluetoothaddress.html">QBluetoothAddress</a> &amp; <i>local</i>, <a href="qbluetooth.html#SDPProfile-enum">QBluetooth::SDPProfile</a> <i>profile</i>, int <i>channel</i> )&nbsp;&nbsp;<tt> [protected]</tt></h3>
<p>Register the SDP service associated with this service. It will be registered on the local device with the given <i>local</i> address, using the given SDP profile <i>profile</i> and RFCOMM channel <i>channel</i>.</p>
<h3 class="fn"><a name="sdpUnregister"></a>bool QBluetoothAbstractService::sdpUnregister ()&nbsp;&nbsp;<tt> [protected]</tt></h3>
<p>Unregisters the SDP service for this service provider. This will fail if <a href="qbluetoothabstractservice.html#sdpRegister">sdpRegister</a>() has not been previously called to register a SDP service.</p>
<h3 class="fn"><a name="setSecurityOptions"></a>void QBluetoothAbstractService::setSecurityOptions ( <a href="qbluetooth.html#SecurityOption-enum">QBluetooth::SecurityOptions</a> <i>options</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Sets the security options for this service to the given <i>options</i>.</p>
<p>Subclasses must override this to set the security options for this service.</p>
<h3 class="fn"><a name="start"></a>void QBluetoothAbstractService::start ( int <i>channel</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Starts this service on the RFCOMM channel <i>channel</i>.</p>
<p>Subclasses must override this to start the service appropriately.</p>
<p>A subclass must emit <a href="qbluetoothabstractservice.html#started">started</a>() when the service has started (i.e. at the end of this method), or failed while trying to start.</p>
<p>If the <a href="qbluetoothabstractservice.html#started">started</a>() signal is emitted with <a href="qbluetooth.html#ServiceError-enum">QBluetooth::SDPServerError</a>, the system will attempt to restart the service on a different channel.</p>
<p><b>Warning:</b> This function must be implementated in such a way that any intermediate objects (which have be created up to the point where the error occured) are cleaned up before the error signal is emitted.</p>
<p>See also <a href="qbluetoothabstractservice.html#started">started</a>().</p>
<h3 class="fn"><a name="started"></a>void QBluetoothAbstractService::started ( <a href="qbluetooth.html#ServiceError-enum">QBluetooth::ServiceError</a> <i>error</i>, const <a href="qstring.html">QString</a> &amp; <i>errorDesc</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This signal should be emitted when the service has started or failed while attempting to start. If there was a failure, the error details should be provided with the <i>error</i> identifier and <i>errorDesc</i> description. Otherwise, <i>error</i> should be <a href="qbluetooth.html#ServiceError-enum">QBluetooth::NoError</a> and <i>errorDesc</i> should be a null <a href="qstring.html">QString</a>.</p>
<h3 class="fn"><a name="stop"></a>void QBluetoothAbstractService::stop ()&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Stops this service.</p>
<p>Subclasses must override this to stop the service appropriately.</p>
<p>A subclass must emit <a href="qbluetoothabstractservice.html#stopped">stopped</a>() when the service has stopped (i.e. at the end of this method), or failed while trying to stop.</p>
<p><b>Warning:</b> An SDP error is not considered to be a critical error. The Bluetooth service manager will still assume that the service is stopped despite the fact that the sdp server couldn't unregister the service. This means the sdp unregistration must be the last step of this function.</p>
<p>See also <a href="qbluetoothabstractservice.html#stopped">stopped</a>().</p>
<h3 class="fn"><a name="stopped"></a>void QBluetoothAbstractService::stopped ( <a href="qbluetooth.html#ServiceError-enum">QBluetooth::ServiceError</a> <i>error</i>, const <a href="qstring.html">QString</a> &amp; <i>errorDesc</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This should must be emitted when the service has stopped or failed while attempting to stop. If there was a failure, the error details should be provided with the <i>error</i> identifier and <i>errorDesc</i> description. Otherwise, <i>error</i> should be <a href="qbluetooth.html#ServiceError-enum">QBluetooth::NoError</a> and <i>errorDesc</i> should be a null <a href="qstring.html">QString</a>.</p>
<h3 class="fn"><a name="translatableDisplayName"></a><a href="qstring.html">QString</a> QBluetoothAbstractService::translatableDisplayName () const&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Returns the display name of this service. This will be used to display the service to the end user (e.g. in the BTSettings application).</p>
<p>Subclasses must override this and return an appropriate name.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2007 <a href="trolltech.html">Trolltech</a></td>
<td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">Qtopia 4.2.1</div></td>
</tr></table></div></address></body>
</html>
