<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Qpk Packages</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="groups.html"><font color="#004faf">Grouped Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">Qpk Packages<br /><span class="subtitle"></span>
</h1>
<ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#using-the-resource-system">Using the Resource System</a></li>
<li><a href="#using-the-help-system">Using the Help System</a></li>
<li><a href="#creating-and-deploying-packages">Creating and deploying packages</a></li>
<li><a href="#the-packages-list-file">The packages.list File</a></li>
<li><a href="#troubleshooting-package-installation">Troubleshooting package installation</a></li>
<li><a href="#faq">FAQ</a></li>
</ul>
<a name="introduction"></a>
<h2>Introduction</h2>
<p>Qtopia uses a custom .qpk format for installable packages. Each .qpk file consists of program files organized in a specific directory structure that has been compressed.</p>
<p>It should be stressed that the qpk installation system was not meant to be a general purpose package installation system like ipkg. Packages installed with the qpk format have a number of limitations:</p>
<ul>
<li>They are not quicklaunchable. If the project (.pro) file specifies CONFIG+=<a href="buildsystem/conf-qtopia-main-1.html">qtopia_main</a> it <i>must</i> also specify CONFIG+=<a href="buildsystem/conf-no-quicklaunch-1.html">no_quicklaunch</a>.</li>
<li>New <a href="services.html">Services</a> cannot be installed as qpk packages</li>
<li>Packages should effectively be self contained applications with dependencies only on Qtopia. A package cannot be for example just a plugin or library to be used by other applications, it <i>must</i> have an executable and corresponding desktop file.</li>
<li>Packages are installed into a specific directory as specified in <tt>Storage.conf</tt>. Each package is allocated its own individual file tree when installed as shown in the image below.</li>
</ul>
<p align="center"><img src="images/package.png" /></p><a name="using-the-resource-system"></a>
<h2>Using the Resource System</h2>
<p>To take advantage of the resource system, resources such as images and sounds should be installed into specific directories.</p>
<p>To register images, the <a href="buildsystem/hint-pics-1.html">pics install hint</a> should be used in the project file. Be aware that the install task .path must be /pics/&lt;appname&gt; where &lt;appname&gt; refers to the application executable filename. Icons and images which depend on the language need to be placed in particular directories as outlined in the <a href="buildsystem/over-installpic-algorithm-1.html">installpic Algorithm</a>.</p>
<p>Assuming that there is a image called foobar.png and an icon called foobaricon.png, then the following code can be used to access those resources:</p>
<pre>    QPixmap myPic(&quot;:image/foobar&quot;);
    QIcon myIcon(&quot;:icon/foobaricon&quot;);</pre>
<p>The icon that associated with the application needs to be specified in a <a href="desktopfiles.html">.desktop</a> file. The Icon field should look something like:</p>
<pre>    [DesktopEntry]
    ...
    Icon=&lt;appname&gt;/iconfile
    ...</pre>
<p>To register sounds an install task should be specified like so:</p>
<pre>    foo.files=sounds/*
    foo.path=/sounds/&lt;appname&gt;
    INSTALLS+=foo</pre>
<p>Assuming that there is a sound called foobar.wav, then the following code can be used to access that sound:</p>
<pre>    QSound mySound(&quot;:sound/foobar&quot;);</pre>
<a name="using-the-help-system"></a>
<h2>Using the Help System</h2>
<p>To provide help information to users, the <a href="buildsystem/hint-help-1.html">help install hint</a> should be used. Bear in mind that the help files are placed in &lt;helproot&gt;/html or &lt;helproot&gt;/&lt;lang&gt;/html and not directly in the &lt;helproot&gt; directory.</p>
<p>At least one help file should be provided called &lt;appname&gt;.html where appname is the application binary name. This is the first help file that is presented to the user when the help option in the soft menu is invoked. Any other help files should be of the form &lt;appname&gt;-suffix.html eg. myapplication-howto.html.</p>
<p>As a side note, you may use <a href="qsoftmenubar.html#menuFor">QSoftMenuBar::menuFor</a>() to generate a context menu which has a help option.</p>
<a name="creating-and-deploying-packages"></a>
<h2>Creating and deploying packages</h2>
<p>To make a package available for download and installation follow these steps:</p>
<ol type="1">
<li>To build a package use the <tt>make packages</tt> command. This will create a pkg subdirectory containing the qpk package.</li>
<li>Identify the directory your web server is serving from and create a feed directory there. The feed directory should by owned by the user who will publish packages.<p><b>Note</b>: For a default apache2 installation, content will be served from <tt>/srv/www/htdocs</tt>.</p>
<p>You will likely need root privileges to create the feed directory and set the desired ownership. For example:</p>
<pre>    sudo mkdir -p /srv/www/htdocs/feed
    sudo chown user.group /srv/www/htdocs/feed</pre>
<p>where <tt>user</tt> and <tt>group</tt> are the user name and group name of the user who will publish packages.</p>
</li>
<li>Copy the the package file (package files have a <tt>.qpk</tt> extension) into the feed directory and run the <tt>mkPackages</tt> script to generate the <a href="#pkgslist"><tt>packages.list</tt></a> file. For example:<pre>    sudo cp myappp.qpk /srv/www/htdocs/feed
    cd /srv/www/htdocs/feed
    sudo $QPEDIR/bin/mkPackages</pre>
<p>(Aside: <tt>mkPackages</tt> allows you to specify the feed directory directly eg mkPackages /srv/www/htdocs/feed, this will recursively search through the current directory for any packages, copy them into the feed and generate the packages.list; be sure to remove any i18n &quot;packages&quot; first.)</p>
</li>
<li>Set up the device to point to the package server feed. There are two ways to do this:<ul>
<li>Add the package server to a running Qtopia device by running the <tt>Settings-&gt;Software Packages</tt> application on the device.</li>
<li>Add a package server by editing/creating the <tt>$HOME/Application/packagemanager/ServersList.conf</tt> file on the device with an entry similar to that below:<pre>        [Local packages]
        http:<span class="comment">//</span>10.10.10.21/feed
        active=true</pre>
</li>
</ul>
</li>
<li>Install package on to the device. When launched, the <tt>Software Packages</tt> application will connect to the active package server using HTTP and will download the <tt>packages.list</tt> file. It will then offer the any packages suitable for download. Packages which suitable include those not already installed and those that match the device and version of Qtopia. Any package that doesn't meet this criteria are not made available and are not able to be installed.</li>
</ol>
<a name="pkgslist"></a><a name="the-packages-list-file"></a>
<h2>The packages.list File</h2>
<p>The <tt>packages.list</tt> file is divided into sections - one per available package.</p>
<p>Each section consists of multiple lines containing mandatory properties of a package as shown in the following table:</p>
<p><table align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Property</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td>Package</td><td>Name of the package displayed by the <tt>Software Packages</tt> application.</td></tr>
<tr valign="top" class="even"><td>Filename</td><td>File name of the package.</td></tr>
<tr valign="top" class="odd"><td>Size</td><td>Size of the compressed package in bytes.</td></tr>
<tr valign="top" class="even"><td>MD5Sum</td><td>MD5 sum of the package file.</td></tr>
<tr valign="top" class="odd"><td>Description</td><td>Package information.</td></tr>
<tr valign="top" class="even"><td>Maintainer</td><td>Person or company responsible for package maintenance.</td></tr>
<tr valign="top" class="odd"><td>License</td><td>License type such as Commercial or GPL.</td></tr>
<tr valign="top" class="even"><td>Version</td><td>Version of the application packaged.</td></tr>
<tr valign="top" class="odd"><td>Trust</td><td>Packages can be trusted or untrusted.</td></tr>
<tr valign="top" class="even"><td>Arch</td><td>CPU architecture of the device such as <tt>arm</tt> or <tt>i386</tt>.</td></tr>
<tr valign="top" class="odd"><td>Architecture</td><td>Device name: for example, Greenphone.</td></tr>
<tr valign="top" class="even"><td>Domain</td><td>SXE domains which the package requires to run delimited by comma: for example, <tt>window,docapi</tt>.</td></tr>
<tr valign="top" class="odd"><td>Files</td><td>All files contained in the package separated by space including their default installation paths.</td></tr>
<tr valign="top" class="even"><td>Installed-Size</td><td>Size of the package after its decompression and installation.</td></tr>
<tr valign="top" class="odd"><td>QtopiaVersion</td><td>The versions of Qtopia this package is compatible with.</td></tr>
<tr valign="top" class="even"><td>Devices</td><td>The type of devices this packages is compatible with.</td></tr>
</table></p>
<a name="troubleshooting-package-installation"></a>
<h2>Troubleshooting package installation</h2>
<p>To isolate any problem if a package is not installing, turn on Package Management logging either via the <tt>Settings-&gt;Logging</tt> application or by editing the <tt>Log.conf</tt> file and then restart qtopia. The log output will provide more detailed information on what is happening during package installation.</p>
<p>The logging out put can be viewed in a number of ways</p>
<ul>
<li>use the <tt>Settings-&gt;Logging</tt> application</li>
<li>view the QtopiaLog.txt file on the device, the location of this file depends on how the device is configured. On the greenphone this file is located at: /mnt/user_local.</li>
<li>use the logread facility on the device</li>
<li>Depending on the device, it may be possible to forward the log output to a host machine.</li>
<li>If working on a desktop with qvfb then logging can be seen on the console output.</li>
</ul>
<a name="faq"></a>
<h2>FAQ</h2>
<p><b>Q</b>: My packages are in the feed directory but why I can't see them with <tt>Software Packages</tt>?</p>
<p><b>A</b>: Ensure that you have re-generated the packages.list file with <tt>mkPackages</tt>. Also ensure that the package is compatible with the version of Qtopia on the device and the device itself, otherwise they will not be visible and cannot be installed. Turning on Package Mangement logging help will give more details.</p>
<p><b>Q</b>: I have a package from Qtopia version x but i want to use it on Qtopia version y but I can't because x and y are not binary compatible.</p>
<p><b>A</b>: If you want to try a package that is not compatible with the version of Qtopia on the device you can use the <tt>modqpk</tt> script to modify the package's QtopiaVersion field. QtopiaVersion consists of a comma delimited list of versions which can include ranges eg, 4.1,4.2&#x2e;0-4.2&#x2e;4&#x2e; Generally, it is not recommended that this be done.</p>
<p><b>Q</b>: I've made a qpk package for the desktop and am running Qtopia with qvfb and it works fine, but when I try the same qpk on another desktop machine, the package doesn't run.</p>
<p><b>A</b>: The runtime library path is hardcoded into the package executable at compile time. On a device this isn't a problem since all the devices will have the same file system structure. For the desktop, the situation is different since on one machine the path may be /home/bob/Qtopia/lib while on another it's /home/bert/Qtopia/lib; a workaround may be to modify the LD_LIBRARY_PATH or just recompile the package for the other machine.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2008 <a href="trolltech.html">Trolltech</a></td>
<td align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qtopia 4.3.1</div></td>
</tr></table></div></address></body>
</html>
