<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Running Qtopia</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">Running Qtopia<br /><small></small></h1>
<a name="top"></a><ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#the-location-of-the-qtopia-image-directory">The Location of the Qtopia Image Directory</a></li>
<ul><li><a href="#environment-settings-to-run-qtopia">Environment Settings to Run Qtopia</a></li>
</ul>
<li><a href="#running-qtopia-on-the-desktop-machine">Running Qtopia on the Desktop Machine</a></li>
<li><a href="#running-qtopia-on-an-embedded-device">Running Qtopia on an Embedded Device</a></li>
<ul><li><a href="#using-an-nfs-mount-partition">Using an NFS Mount Partition</a></li>
<ul><li><a href="#step-1-setting-up-the-device">Step 1: Setting up the Device</a></li>
<li><a href="#step-2-exporting-the-qtopia-image-directory-to-the-device">Step 2: Exporting the Qtopia Image Directory to the Device</a></li>
<li><a href="#step-3-connecting-to-the-device">Step 3: Connecting to the Device</a></li>
</ul>
<li><a href="#using-a-binary-flashed-onto-the-device">Using a Binary Flashed onto the Device</a></li>
</ul>
<li><a href="#touchscreen-phone-calibration">Touchscreen Phone Calibration</a></li>
<li><a href="#connecting-qtopia-phone-to-the-phone-device">Connecting Qtopia Phone to the Phone Device</a></li>
<ul><li><a href="#using-a-phone-simulator">Using a Phone Simulator</a></li>
<li><a href="#using-a-phone-device">Using a Phone Device</a></li>
</ul>
</ul>
<a name="introduction"></a>
<h2>Introduction</h2>
<p>This document describes the commands required to run Qtopia. It is assumed that the Qtopia binaries have been installed using either:</p>
<ul>
<li>an SDK package</li>
<li>or have been built using a source package according to the <a href="build-from-source.html">Build Instructions</a>.</li>
</ul>
<p>For the purpose of this document, the term, <i>desktop</i> refers to a desktop computer running a Linux distribution. There is also an application named Qtopia Desktop and this application is either installed as part of the downloaded package or is available from the <a href="http://www.trolltech.com">Trolltech website</a>.</p>
<p>Qtopia can be run connected to either the Qt Virtual Framebuffer(QVFb) on a desktop or a real framebuffer on an embedded device. Running Qtopia connected to the QVFb is ideal for developing code, debugging and demonstrating a product. However Qtopia will need to be run on the embedded device to provide a clearer indication of performance and how well the embedded device's hardware interacts with Qtopia.</p>
<p>Running Qtopia on an embedded device requires different binaries from those used to run Qtopia on the desktop. Creating binaries for an embedded device is not difficult and is done using a cross-compiler. This is handled in the <a href="howtobuild.html">Detailed Build Instructions</a> section of the reference documentation. If you have installed an SDK package then you will find pre-built binaries for an embedded device in specific sub-directories, for instance /opt/Qtopia/SDK/&lt;version&gt;/greenphone. In an SDK package these binaries cannot be rebuilt. For a Qtopia source package the binaries can be built in any configuration required.</p>
<p>If you only want to run Qtopia on your desktop machine at this time, then the device-specific binaries are irrelevant. However if you do want to run Qtopia on a device then it is assumed that the binaries for that specific type of device are available.</p>
<p>If this is your first encounter with Qtopia and/or cross-compiling then it might be best to start with experimenting on the desktop and when you are comfortable with that, start running Qtopia on a device.</p>
<a name="the-location-of-the-qtopia-image-directory"></a>
<h2>The Location of the Qtopia Image Directory</h2>
<p>Qtopia runs using files in the <tt>image</tt> directory. The image directory contains all the files required to run Qtopia and will make packaging and deployment efforts to install Qtopia with your own applications onto a device a lot easier.</p>
<p>The location of the Qtopia Image Directory is dependent on the package being used. The following table displays the default locations:</p>
<p><table align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Package</th><th>Location</th></tr></thead>
<tr valign="top" class="odd"><td>Source package</td><td><tt>&lt;qtopia-root-dir&gt;/image</tt></td></tr>
<tr valign="top" class="even"><td>SDK package x86</td><td><tt>/opt/Qtopia/SDK/&lt;version/x86</tt>.</td></tr>
<tr valign="top" class="odd"><td>SDK package &lt;device&gt;</td><td><tt>/opt/Qtopia/SDK/&lt;version/&lt;device&gt;</tt>.</td></tr>
</table></p>
<p>where <tt>&lt;qtopia-root-dir&gt;</tt> is the install location of the source package and &lt;device&gt; is the device in which Qtopia needs to be installed.</p>
<p>The image directory for source packages may be changed to meet your requirements by using the <tt>-prefix</tt> option with the <tt>configure</tt> script for SDK packages the directory is fixed to /opt/Qtopia/SDK/&lt;version&gt;/&lt;something&gt;.</p>
<a name="environment-settings-to-run-qtopia"></a>
<h3>Environment Settings to Run Qtopia</h3>
<p>The following environment variables must be set prior to running Qtopia:</p>
<ul>
<li><tt>PATH</tt></li>
<li><tt>LD_LIBRARY_PATH</tt></li>
</ul>
<p>For example if the Qtopia image directory is :</p>
<pre>    /opt/Qtopia</pre>
<p>use the following commands to set the above variables:</p>
<pre>    export PATH=/opt/Qtopia/bin:$PATH
    export LD_LIBRARY_PATH=/opt/Qtopia/lib:$LD_LIBRARY_PATH</pre>
<a name="running-qtopia-on-the-desktop-machine"></a>
<h2>Running Qtopia on the Desktop Machine</h2>
<p>To run Qtopia on the desktop a <tt>runqtopia</tt> script is provided. The exact location of the script depends on the package:</p>
<p><table align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>package</th><th>location</th></tr></thead>
<tr valign="top" class="odd"><td>SDK package</td><td>/opt/Qtopia/SDK/scripts/runqtopia</td></tr>
<tr valign="top" class="even"><td>Source package</td><td>&lt;qtopia-root-dir&gt;/scripts/runqtopia</td></tr>
</table></p>
<p>where <tt>&lt;qtopia-root-dir&gt;</tt> is the install location of the source package.</p>
<p>The <i>runqtopia</i> script performs the following:</p>
<ul>
<li>sets environment variables</li>
<li>determines an appropriate skin for the run</li>
<li>sets up sound card support</li>
<li>sets up a HOME path (if required)</li>
<li>runs QVFb</li>
<li>runs the phone simulator (if required)</li>
<li>runs Qtopia.</li>
</ul>
<p>To quit Qtopia and close all Qtopia applications, right click the outside area of QVFb and select <tt>File-&gt;Quit</tt>.</p>
<p>QVFb is run using a specific skin depending on the package installed. A skin is simply a set of XML files that define the look and feel of QVFb. You may use a different skin, or create your own to replicate your target device. If you are not familiar with QVFb please refer to: <a href="qtopiacore-qvfb.html">Qtopia QVFb </a> before continuing.</p>
<p>In practice the <tt>runqtopia</tt> script can be used in all cases to conveniently start Qtopia. In exceptional cases where the script does not perform as expected, it is is advised to take the script as the starting point and modify the procedure to meet your specific requirements.</p>
<p>The script accepts a number of parameters:</p>
<pre>    The defaults (*) are usually acceptable. A plus (+) denotes a default
    value that needs to be evaluated. If the evaluation succeeds, the
    feature is included. Here is a short explanation of each option:

        -display num ...........  Use display number &lt;num&gt;
                                  Default: 0
        -skin skin .............  Use QVFb skin &lt;skin&gt;
                                  Available: ClamshellPhone, DualScreenPhone, pda,
                                  PDAPhone, PortableMedia, SmartPhone, SmartPhone2,
                                  SmartPhoneWithButtons, TouchscreenPhone,
                                  Trolltech-Keypad, Trolltech-Touchscreen,
                                  Greenphone, Nokia-770, Trolltech-PDA
                                  Default: Greenphone
        -rotation angle ........  Use rotation &lt;angle&gt;
                                  Available: 0, 90, 180, 270
                                  Default: 0
        -home home .............  Use HOME &lt;home&gt;
                                  Default: /home/roconnor/build/qtopia/4.3.0_phone_r
                                  elease_quicklaunch/home
        -sxe-discovery .........  Enable SXE_DISCOVERY_MODE.
        -qvfb arg ..............  Extra arguments for QVFb
        -qvfb-only .............  Only run QVFb

            For arguments to the 'runqpe' part of this script, use [script
            arguments] -- [runqpe arguments]</pre>
<p>For further information and a description of environment variables used by the script, use the command:</p>
<pre>        runqtopia -help</pre>
<p><b>Note:</b> To connect to a modem device instead of the simulator, modify the QTOPIA_PHONE_DEVICE variable and <b>DO NOT</b> start <tt>phonesim</tt>. If the <tt>runqtopia</tt> script is used, it will automatically skip the phone simulator unless this variable is set to <tt>sim:localhost</tt>. This subject is discussed in more detail in one of the next sections.</p>
<a name="running-qtopia-on-an-embedded-device"></a>
<h2>Running Qtopia on an Embedded Device</h2>
<p>This section describes the procedure to run Qtopia on a device and is the same for all Qtopia editions.</p>
<a name="using-an-nfs-mount-partition"></a>
<h3>Using an NFS Mount Partition</h3>
<p>This section describes how to run Qtopia on a device using an NFS mount partition.</p>
<p>To use an NFS mount partition your device requires a network connection with the desktop machine and accesses Qtopia binaries on the desktop machine. The binaries must be cross-compiled for the device-type (e.g. ARM) and you control the start/stop of Qtopia through a terminal connection to the device.</p>
<p>This approach is ideal for debugging and testing on a real device. The binaries can be quickly modified and re-built and the application under test can be restarted almost instantly. It provides an efficient work process when compared with the delays introduced by building packages and the usually very slow upload and flash process required to run Qtopia from a standalone device.</p>
<a name="step-1-setting-up-the-device"></a>
<h4>Step 1: Setting up the Device</h4>
<p>To setup the device, use command line tools (or whatever is available on the device) to setup the network configuration and use <i>ifconfig</i> to determine the IP address. <b>Note:</b> Network settings in Qtopia can be used, however, you would need to exit that Qtopia in order to run over the network.</p>
<a name="step-2-exporting-the-qtopia-image-directory-to-the-device"></a>
<h4>Step 2: Exporting the Qtopia Image Directory to the Device</h4>
<p>To export the Qtopia image directory to the device, execute the following commands on the desktop machine:</p>
<ol type="1">
<li>First verify that NFS is running:<pre>         ps aux | grep nfs</pre>
<p>Output will be something like this:</p>
<pre>    tester@desk:~&gt; ps aux | grep nfs
    root     10661  0.0  0.0     0    0 ?        SW   16:20   0:00 [nfsd]
    root     10662  0.0  0.0     0    0 ?        SW   16:20   0:00 [nfsd]
    tester     10554  0.0  0.1  3540  564 pts/8    S    16:12   0:00 grep nfs</pre>
<p>If you only get the bottom line, then NFS is NOT running and needs to be started.</p>
<p>To start NFS use <tt>/etc/init.d/nfsserver</tt> start (or similar) as root.</p>
</li>
<li>indicate to NFS to export a directory by editing the <tt>/etc/exports</tt> file (as root) and adding the following line:<pre>         /path/to/image/ *(ro)</pre>
<p>This exports the <tt>/path/to/image</tt> directory (and all subdirectories), and gives read-only access from any computer. In this procedure it is assumed this is the directory you want to export.</p>
</li>
<li>indicate to NFS (again as root) that the configuration has changed using:<pre>         exportfs -a</pre>
<p>The Qtopia binaries in <tt>/path/to/image/Qtopia/bin</tt> are now accessible from the network.</p>
</li>
</ol>
<a name="step-3-connecting-to-the-device"></a>
<h4>Step 3: Connecting to the Device</h4>
<ol type="1">
<li>login to the connected device via telnet or ssh (using the IP address displayed in the current tab)</li>
<li>enter your password as root and create the directory on the device that links to the desktop file system using the following command:<pre>         mkdir -p /opt/Qtopia</pre>
</li>
<li>mount/assign the file system to the device by mounting the created folder using the following command:<pre>        mount desk:/path/to/image/Qtopia -orsize=8192,wsize=8192 /opt/Qtopia</pre>
</li>
<li>You should now be able to fill <tt>/path/to/image/Qtopia</tt> on your desktop machine (named <i>desk</i>) with files that are accessible from the device.</li>
</ol>
<a name="using-a-binary-flashed-onto-the-device"></a>
<h3>Using a Binary Flashed onto the Device</h3>
<p>This is the ultimate goal and is mentioned here for completeness. However, this option is clearly not within the scope of this introduction.</p>
<p>As a general rule Qtopia (or any other application) can be flashed onto a device using a CF or SD card or can be uploaded onto the device using a serial connection. Usually this means the image (for example, <tt>/path/to/image</tt>) must first be packed into a special file such as <tt>initrd.bin</tt>. This file is uploaded and flashed into the device flash memory. The correct procedure is entirely dependent on the device used and cannot be described here. Please refer to the device manufacturers documentation for details of installing to the device.</p>
<p>Once the software is installed on the device the general rule is to reboot the device and the Linux boot script will ensure that Qtopia is started automatically. If this doesn't work it is a system integration task to modify the relevant boot scripts.</p>
<p>So, from a Qtopia perspective, running Qtopia on a device means: power on the device and off you go!</p>
<p>For more information about system integration refer to <a href="syscust-index.html">System Customization</a>.</p>
<a name="touchscreen-phone-calibration"></a>
<h2>Touchscreen Phone Calibration</h2>
<p>When building Qtopia Phone edition for a touchscreen device, the touchscreen must be calibrated manually as <i>Calibration</i> is not run automatically. With Qtopia Phone running, enter the following command to start calibration:</p>
<pre>          qcop service send Launcher &quot;execute(QString)&quot; &quot;calibrate&quot;</pre>
<p>This outputs calibration information to the <tt>$HOME/Settings/pointercal</tt> file which should be copied to <tt>/etc/</tt> to avoid repeating this process.</p>
<p><b>Note:</b> QPE_NEED_CALIBRATION must be defined in the <tt>custom-&lt;xplatform-spec&gt;.h</tt> file. See also: <a href="syscust-index.html">Device Configuration</a>.</p>
<a name="connecting-qtopia-phone-to-the-phone-device"></a>
<h2>Connecting Qtopia Phone to the Phone Device</h2>
<p>Qtopia Phone provides the GUI software that runs on a mobile phone. To make a <i>real</i> phone call the electronics need to connect to a phone network. These electronics are assumed to be in the phone device itself. This section describes how the Qtopia Phone software can be connected to the phone device hardware.</p>
<a name="using-a-phone-simulator"></a>
<h3>Using a Phone Simulator</h3>
<p>The phone simulator is an internal tool used to test part of the Qtopia Phone functionality. It simulates part of the modem functionality and is the first step in debugging software. The simulator has been included in the package because it is well suited to illustrating the capabilities of Qtopia Phone. Please be advised however that the phone simulator is an unsupported tool.</p>
<p>Connect Qtopia Phone to the simulator using the following command:</p>
<pre>         export QTOPIA_PHONE_DEVICE=sim:localhost</pre>
<p>This must be set before either Qtopia or the simulator are started. If the <tt>runqtopia</tt> script is used, the default value for the environment variable <tt>QTOPIA_PHONE_DEVICE</tt> is <tt>sim:localhost</tt>. It is possible to run Qtopia Phone on one machine (embedded device) and the phone simulator on another machine. To do this replace <i>localhost</i> with the name of the machine on which the <tt>phonesim</tt> is running.</p>
<p>Further phone simulator information is available in the <a href="tools-list.html">Tools section</a> of the reference documentation. To call to peers in the same network the <tt>peers.xml</tt> file must be modified by entering valid machine names within your network environment.</p>
<a name="using-a-phone-device"></a>
<h3>Using a Phone Device</h3>
<p>Qtopia Phone can be connected to a real phone device using a serial connection. Please be advised that the phone device must support the standard AT commands. To connect use the following command:</p>
<pre>         export QTOPIA_PHONE_DEVICE=/dev/ttyS1:115200
         export QTOPIA_PHONE_VENDOR=wavecom</pre>
<p>where:</p>
<ul>
<li>ttyS1 = the serial port</li>
<li>115200 = the baud rate</li>
<li>wavecom = the name of the modem plugin to use</li>
</ul>
<p>When using Qtopia connect to a modem the environment variables <tt>QTOPIA_PHONE_DEVICE</tt> and <tt>QTOPIA_PHONE_VENDOR</tt> must be set before Qtopia Phone is started. Entering a baud rate after the serial port name is optional and depends on the modem being used. It is not necessary to start the <tt>phonesim</tt> application.</p>
<p>If you wish to start Qtopia with multiplexing disabled then use the following command before starting Qtopia Phone:</p>
<pre>         export QTOPIA_PHONE_MUX=no</pre>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2007 <a href="trolltech.html">Trolltech</a></td>
<td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">Qtopia 4.2.1</div></td>
</tr></table></div></address></body>
</html>
