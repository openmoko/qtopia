<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>QtopiaSql Class Reference</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="groups.html"><font color="#004faf">Grouped Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">QtopiaSql Class Reference</h1>
<p>The QtopiaSql class provides a collection of methods for setting up and managing database connections. <a href="#details">More...</a></p>
<pre>    #include &lt;QtopiaSql&gt;</pre><ul>
<li><a href="qtopiasql-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="static-public-members"></a>
<h3>Static Public Members</h3>
<ul>
<li><div class="fn"/>QSqlDatabase <b><a href="qtopiasql.html#applicationSpecificDatabase">applicationSpecificDatabase</a></b> ( const QString &amp; <i>appname</i> )</li>
<li><div class="fn"/>void <b><a href="qtopiasql.html#attachDB">attachDB</a></b> ( const QString &amp; <i>path</i> )</li>
<li><div class="fn"/>void <b><a href="qtopiasql.html#attachDB-2">attachDB</a></b> ( const QString &amp; <i>path</i>, const QString &amp; <i>dbPath</i> )</li>
<li><div class="fn"/>QSqlDatabase &amp; <b><a href="qtopiasql.html#database">database</a></b> ( const QtopiaDatabaseId &amp; <i>id</i> )</li>
<li><div class="fn"/>QtopiaDatabaseId <b><a href="qtopiasql.html#databaseIdForDatabasePath">databaseIdForDatabasePath</a></b> ( const QString &amp; <i>dbPath</i> )</li>
<li><div class="fn"/>QtopiaDatabaseId <b><a href="qtopiasql.html#databaseIdForPath">databaseIdForPath</a></b> ( const QString &amp; <i>path</i> )</li>
<li><div class="fn"/>const QList&lt;QtopiaDatabaseId&gt; <b><a href="qtopiasql.html#databaseIds">databaseIds</a></b> ()</li>
<li><div class="fn"/>QString <b><a href="qtopiasql.html#databasePathForId">databasePathForId</a></b> ( const QtopiaDatabaseId &amp; <i>id</i> )</li>
<li><div class="fn"/>const QList&lt;QSqlDatabase&gt; <b><a href="qtopiasql.html#databases">databases</a></b> ()</li>
<li><div class="fn"/>void <b><a href="qtopiasql.html#detachDB">detachDB</a></b> ( const QString &amp; <i>path</i> )</li>
<li><div class="fn"/>bool <b><a href="qtopiasql.html#ensureTableExists">ensureTableExists</a></b> ( const QString &amp; <i>tableName</i>, QSqlDatabase &amp; <i>db</i> )</li>
<li><div class="fn"/>bool <b><a href="qtopiasql.html#ensureTableExists-2">ensureTableExists</a></b> ( const QStringList &amp; <i>tableNames</i>, QSqlDatabase &amp; <i>db</i> )</li>
<li><div class="fn"/>QString <b><a href="qtopiasql.html#escapeString">escapeString</a></b> ( const QString &amp; <i>input</i> )</li>
<li><div class="fn"/>QSqlError <b><a href="qtopiasql.html#exec">exec</a></b> ( const QString &amp; <i>query</i>, QSqlDatabase &amp; <i>db</i>, bool <i>inTransaction</i> = true )</li>
<li><div class="fn"/>QSqlError <b><a href="qtopiasql.html#exec-2">exec</a></b> ( QSqlQuery &amp; <i>query</i>, QSqlDatabase &amp; <i>db</i>, bool <i>inTransaction</i> = true )</li>
<li><div class="fn"/>bool <b><a href="qtopiasql.html#isDatabase">isDatabase</a></b> ( const QString &amp; <i>path</i> )</li>
<li><div class="fn"/>void <b><a href="qtopiasql.html#loadConfig">loadConfig</a></b> ( const QString &amp; <i>type</i>, const QString &amp; <i>name</i>, const QString &amp; <i>user</i> )</li>
<li><div class="fn"/>void <b><a href="qtopiasql.html#logQuery">logQuery</a></b> ( const QSqlQuery &amp; <i>q</i> )</li>
<li><div class="fn"/>void <b><a href="qtopiasql.html#openDatabase">openDatabase</a></b> ()</li>
<li><div class="fn"/>int <b><a href="qtopiasql.html#stringCompare">stringCompare</a></b> ( const QString &amp; <i>l</i>, const QString &amp; <i>r</i> )</li>
<li><div class="fn"/>QSqlDatabase &amp; <b><a href="qtopiasql.html#systemDatabase">systemDatabase</a></b> ()</li>
</ul>
<a name="details"></a>
<hr />
<h2>Detailed Description</h2>
<p>The QtopiaSql class provides a collection of methods for setting up and managing database connections.</p>
<p>Qtopia has a database architecture which uses a number of different databases, including a seperate database for each removable storage media. Additionally the database schema required for a particular version of Qtopia may differ from that currently on the device due to Qtopia being upgraded.</p>
<p>Use these routines to manage connections to these databases. The <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> type identifies a particular database of the collectin.</p>
<p>The <a href="qtopiasql.html#systemDatabase">systemDatabase</a>() method is used to fetch a <a href="qsqldatabase.html">QSqlDatabase</a> object pointing to the Qtopia main system database. Call <a href="qtopiasql.html#attachDB">attachDB</a>() to connect a database for a particular path, typically associated with a new storage media mount-point. These will be operated on with the system database as a unit.</p>
<p>Lists of the current databases can be obtained with <a href="qtopiasql.html#databaseIds">databaseIds</a>() and <a href="qtopiasql.html#databases">databases</a>(). Given a database id obtain the path for the associated media mount point with <a href="qtopiasql.html#databasePathForId">databasePathForId</a>() and obtain the <a href="qsqldatabase.html">QSqlDatabase</a> itself with <a href="qtopiasql.html#database">database</a>().</p>
<p>The <a href="qtopiasql.html#ensureTableExists">ensureTableExists</a>() methods call through to the Database migration utility to ensure the table schema referred to is loaded.</p>
<p>The <a href="qtopiasql.html#attachDB">attachDB</a>() methods use the underlying database implementation specific method for creating queries across seperate databases. In SQLITE this method is the ATTACH statement, but an equivalent method is used for other implementations.</p>
<hr />
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="applicationSpecificDatabase"></a><a href="qsqldatabase.html">QSqlDatabase</a> QtopiaSql::applicationSpecificDatabase ( const <a href="qstring.html">QString</a> &amp; <i>appname</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Return a <a href="qsqldatabase.html">QSqlDatabase</a> object for the database specific to the application given by <i>appname</i></p>
<h3 class="fn"><a name="attachDB"></a>void QtopiaSql::attachDB ( const <a href="qstring.html">QString</a> &amp; <i>path</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Attach the database for the media located at the mount-point <i>path</i>. The database to use is located on that media.</p>
<p>After this call database entries for the attached database will be used in future queries executed.</p>
<p>See also <a href="qtopiasql.html#exec">exec</a>().</p>
<h3 class="fn"><a name="attachDB-2"></a>void QtopiaSql::attachDB ( const <a href="qstring.html">QString</a> &amp; <i>path</i>, const <a href="qstring.html">QString</a> &amp; <i>dbPath</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>This is an overloaded member function, provided for convenience.</p>
<p>Attach the database for the media located at the mount-point <i>path</i>. The path given by <i>dbPath</i> is the database to use in the attach.</p>
<p>See also <a href="qtopiasql.html#exec">exec</a>().</p>
<h3 class="fn"><a name="database"></a><a href="qsqldatabase.html">QSqlDatabase</a> &amp; QtopiaSql::database ( const <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> &amp; <i>id</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Returns a reference to the qtopia database object (used for settings storage, doc manager, etc) for the given <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> <i>id</i>. There is a separate set of database objects created per thread.</p>
<h3 class="fn"><a name="databaseIdForDatabasePath"></a><a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> QtopiaSql::databaseIdForDatabasePath ( const <a href="qstring.html">QString</a> &amp; <i>dbPath</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Return the <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> identifier for the database located at the given <i>dbPath</i>.</p>
<p>Internally causes the database system to be opened, if not already open.</p>
<h3 class="fn"><a name="databaseIdForPath"></a><a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> QtopiaSql::databaseIdForPath ( const <a href="qstring.html">QString</a> &amp; <i>path</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Return the <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> identifier for the database associated with the given <i>path</i>.</p>
<p>Internally causes the database system to be opened, if not already open.</p>
<h3 class="fn"><a name="databaseIds"></a>const <a href="qlist.html">QList</a>&lt;<a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a>&gt; QtopiaSql::databaseIds ()&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Return a list of the <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> entries for all the attached databases.</p>
<p>Internally causes the database system to be opened, if not already open.</p>
<h3 class="fn"><a name="databasePathForId"></a><a href="qstring.html">QString</a> QtopiaSql::databasePathForId ( const <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> &amp; <i>id</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Return the full path to the mount-point related to the database for the given <a href="qcontent.html#QtopiaDatabaseId-typedef">QtopiaDatabaseId</a> <i>id</i></p>
<h3 class="fn"><a name="databases"></a>const <a href="qlist.html">QList</a>&lt;<a href="qsqldatabase.html">QSqlDatabase</a>&gt; QtopiaSql::databases ()&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Returns a list <a href="qsqldatabase.html">QSqlDatabase</a> objects comprising all attached databases.</p>
<h3 class="fn"><a name="detachDB"></a>void QtopiaSql::detachDB ( const <a href="qstring.html">QString</a> &amp; <i>path</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Undo the effect of the <a href="qtopiasql.html#attachDB">attachDB</a>() method, for the database associated with mount-point <i>path</i>.</p>
<p>After this call database queries executed will not attempt to reference this database.</p>
<p>See also <a href="qtopiasql.html#attachDB">attachDB</a>() and <a href="qtopiasql.html#exec">exec</a>().</p>
<h3 class="fn"><a name="ensureTableExists"></a>bool QtopiaSql::ensureTableExists ( const <a href="qstring.html">QString</a> &amp; <i>tableName</i>, <a href="qsqldatabase.html">QSqlDatabase</a> &amp; <i>db</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Ensure that the given table <i>tableName</i> exists in the database <i>db</i></p>
<p>Internally this invokes the &quot;DBMigrationEngine&quot; service to run any migrations or schema updates required.</p>
<p>Return true if the operation was successful; otherwise returns false</p>
<h3 class="fn"><a name="ensureTableExists-2"></a>bool QtopiaSql::ensureTableExists ( const <a href="qstringlist.html">QStringList</a> &amp; <i>tableNames</i>, <a href="qsqldatabase.html">QSqlDatabase</a> &amp; <i>db</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>This is an overloaded member function, provided for convenience.</p>
<p>Ensure that all tables in the list of <i>tableNames</i> exists in the database <i>db</i>.</p>
<p>Internally this invokes the &quot;DBMigrationEngine&quot; service to run any migrations or schema updates required.</p>
<h3 class="fn"><a name="escapeString"></a><a href="qstring.html">QString</a> QtopiaSql::escapeString ( const <a href="qstring.html">QString</a> &amp; <i>input</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Returns a version of the <a href="qstring.html">QString</a> <i>input</i> with all single quote characters replaced with two consecutive quote characters.</p>
<h3 class="fn"><a name="exec"></a><a href="qsqlerror.html">QSqlError</a> QtopiaSql::exec ( const <a href="qstring.html">QString</a> &amp; <i>query</i>, <a href="qsqldatabase.html">QSqlDatabase</a> &amp; <i>db</i>, bool <i>inTransaction</i> = true )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Execute the given <a href="qstring.html">QString</a> <i>query</i> on the database <i>db</i>. If <i>inTransaction</i> is true, then perform the query inside an SQL transaction, for atomicity, if the database backend supports this.</p>
<h3 class="fn"><a name="exec-2"></a><a href="qsqlerror.html">QSqlError</a> QtopiaSql::exec ( <a href="qsqlquery.html">QSqlQuery</a> &amp; <i>query</i>, <a href="qsqldatabase.html">QSqlDatabase</a> &amp; <i>db</i>, bool <i>inTransaction</i> = true )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>This is an overloaded member function, provided for convenience.</p>
<p>Execute the given <a href="qsqlquery.html">QSqlQuery</a> <i>query</i> on the database <i>db</i>. If <i>inTransaction</i> is true, then perform the query inside an SQL transaction, for atomicity, if the database backend supports this.</p>
<h3 class="fn"><a name="isDatabase"></a>bool QtopiaSql::isDatabase ( const <a href="qstring.html">QString</a> &amp; <i>path</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Return true if the file located at the given <i>path</i> is a Qtopia database file, for example the datastore used by the SQLITE engine; return false otherwise.</p>
<p>This may be used to test if the file should be shown to the end-user.</p>
<pre>    if ( !QtopiaSql::isDatabase( fileFound ))
        listForDisplay.append( fileFound );</pre>
<h3 class="fn"><a name="loadConfig"></a>void QtopiaSql::loadConfig ( const <a href="qstring.html">QString</a> &amp; <i>type</i>, const <a href="qstring.html">QString</a> &amp; <i>name</i>, const <a href="qstring.html">QString</a> &amp; <i>user</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Initializes the state of the <a href="qtopiasql.html">QtopiaSql</a> system with the <i>type</i> of database, eg &quot;sqlite&quot;.</p>
<p>The meaning of the <i>name</i> and <i>user</i> parameters are as defined in <a href="qsqldatabase.html">QSqlDatabase</a>.</p>
<h3 class="fn"><a name="logQuery"></a>void QtopiaSql::logQuery ( const <a href="qsqlquery.html">QSqlQuery</a> &amp; <i>q</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Send a string for the given <a href="qsqlquery.html">QSqlQuery</a> <i>q</i> to the qtopia logging system.</p>
<h3 class="fn"><a name="openDatabase"></a>void QtopiaSql::openDatabase ()&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Opens the main system database, if it is not already open.</p>
<h3 class="fn"><a name="stringCompare"></a>int QtopiaSql::stringCompare ( const <a href="qstring.html">QString</a> &amp; <i>l</i>, const <a href="qstring.html">QString</a> &amp; <i>r</i> )&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Perform a locale aware string compare of the two argument QStrings <i>l</i> and <i>r</i> using the database implementations native collating functions.</p>
<p>If the database does not provide one, or if one is provided but not integrated, then returns the same result as <a href="qstring.html#localeAwareCompare">QString::localeAwareCompare</a>()</p>
<h3 class="fn"><a name="systemDatabase"></a><a href="qsqldatabase.html">QSqlDatabase</a> &amp; QtopiaSql::systemDatabase ()&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Return the <a href="qsqldatabase.html">QSqlDatabase</a> instance of the main system database.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2007 <a href="trolltech.html">Trolltech</a></td>
<td align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qtopia 4.2.4</div></td>
</tr></table></div></address></body>
</html>
