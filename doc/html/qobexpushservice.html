<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>QObexPushService Class Reference</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="groups.html"><font color="#004faf">Grouped Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">QObexPushService Class Reference</h1>
<p>The QObexPushService class provides an OBEX Push service. <a href="#details">More...</a></p>
<pre>    #include &lt;QObexPushService&gt;</pre><p>Inherits <a href="./qobject.html">QObject</a>.</p>
<ul>
<li><a href="qobexpushservice-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="public-types"></a>
<h3>Public Types</h3>
<ul>
<li><div class="fn"/>enum <b><a href="qobexpushservice.html#Error-enum">Error</a></b> { NoError, ConnectionError, Aborted, UnknownError }</li>
<li><div class="fn"/>enum <b><a href="qobexpushservice.html#State-enum">State</a></b> { Ready, Connecting, Disconnecting, Streaming, Closed }</li>
</ul>
<a name="public-functions"></a>
<h3>Public Functions</h3>
<ul>
<li><div class="fn"/><b><a href="qobexpushservice.html#QObexPushService">QObexPushService</a></b> ( QIODevice * <i>device</i>, QObject * <i>parent</i> = 0 )</li>
<li><div class="fn"/><b><a href="qobexpushservice.html#dtor.QObexPushService">~QObexPushService</a></b> ()</li>
<li><div class="fn"/>virtual QByteArray <b><a href="qobexpushservice.html#businessCard">businessCard</a></b> () const</li>
<li><div class="fn"/>QIODevice * <b><a href="qobexpushservice.html#currentDevice">currentDevice</a></b> () const</li>
<li><div class="fn"/>Error <b><a href="qobexpushservice.html#error">error</a></b> () const</li>
<li><div class="fn"/>QIODevice * <b><a href="qobexpushservice.html#sessionDevice">sessionDevice</a></b> () const</li>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#setBusinessCard">setBusinessCard</a></b> ( const QByteArray &amp; <i>vCard</i> )</li>
<li><div class="fn"/>State <b><a href="qobexpushservice.html#state">state</a></b> () const</li>
</ul>
<ul>
<li><div class="fn"/>29 public functions inherited from <a href="./qobject.htmlqobject.html#public-functions">QObject</a></li>
</ul>
<a name="public-slots"></a>
<h3>Public Slots</h3>
<ul>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#abort">abort</a></b> ()</li>
</ul>
<ul>
<li><div class="fn"/>1 public slot inherited from <a href="./qobject.htmlqobject.html#public-slots">QObject</a></li>
</ul>
<a name="signals"></a>
<h3>Signals</h3>
<ul>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#businessCardRequested">businessCardRequested</a></b> ()</li>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#dataTransferProgress">dataTransferProgress</a></b> ( qint64 <i>done</i>, qint64 <i>total</i> )</li>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#done">done</a></b> ( bool <i>error</i> )</li>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#putRequested">putRequested</a></b> ( const QString &amp; <i>name</i>, const QString &amp; <i>type</i>, qint64 <i>size</i>, const QString &amp; <i>description</i> )</li>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#requestFinished">requestFinished</a></b> ( bool <i>error</i> )</li>
<li><div class="fn"/>void <b><a href="qobexpushservice.html#stateChanged">stateChanged</a></b> ( QObexPushService::State <i>state</i> )</li>
</ul>
<ul>
<li><div class="fn"/>1 signal inherited from <a href="./qobject.htmlqobject.html#signals">QObject</a></li>
</ul>
<a name="protected-functions"></a>
<h3>Protected Functions</h3>
<ul>
<li><div class="fn"/>virtual QIODevice * <b><a href="qobexpushservice.html#acceptFile">acceptFile</a></b> ( const QString &amp; <i>name</i>, const QString &amp; <i>type</i>, qint64 <i>size</i>, const QString &amp; <i>description</i> )</li>
</ul>
<ul>
<li><div class="fn"/>7 protected functions inherited from <a href="./qobject.htmlqobject.html#protected-functions">QObject</a></li>
</ul>
<h3>Additional Inherited Members</h3>
<ul>
<li><div class="fn"/>1 property inherited from <a href="./qobject.htmlqobject.html#properties">QObject</a></li>
<li><div class="fn"/>1 public type inherited from <a href="./qobject.htmlqobject.html#public-variables">QObject</a></li>
<li><div class="fn"/>4 static public members inherited from <a href="./qobject.htmlqobject.html#static-public-members">QObject</a></li>
<li><div class="fn"/>2 protected variables inherited from <a href="./qobject.htmlqobject.html#protected-variables">QObject</a></li>
</ul>
<a name="details"></a>
<hr />
<h2>Detailed Description</h2>
<p>The QObexPushService class provides an OBEX Push service.</p>
<p>The QObexPushService class can be used to provide OBEX Push services over Bluetooth, Infrared or any other OBEX capable transport. This class implements the Bluetooth Object Push Profile, and can also be used to implement the Infrared IrXfer service.</p>
<p>If you want to control whether an incoming file should be accepted, subclass QObexPushService and override the <a href="qobexpushservice.html#acceptFile">acceptFile</a>() function. Subclasses can also override <a href="qobexpushservice.html#businessCard">businessCard</a>() to provide the default business card object that may be requested by an OBEX Push client.</p>
<p>When an OBEX client sends a file to the service, the <a href="qobexpushservice.html#acceptFile">acceptFile</a>() function is called to determine whether the file transfer should be allowed. If the transfer is accepted, the <a href="qobexpushservice.html#putRequested">putRequested</a>() signal is emitted with the details of the incoming file, and the <a href="qobexpushservice.html#dataTransferProgress">dataTransferProgress</a>() signal will be emitted at intervals to show the progress of the file transfer operation. The <a href="qobexpushservice.html#requestFinished">requestFinished</a>() signal is emitted when the transfer is complete.</p>
<p>Similarly, when an OBEX client requests the default business card, the <a href="qobexpushservice.html#businessCardRequested">businessCardRequested</a>() signal is emitted, and the <a href="qobexpushservice.html#dataTransferProgress">dataTransferProgress</a>() signal will be emitted at intervals. The <a href="qobexpushservice.html#requestFinished">requestFinished</a>() signal is emitted when the transfer is complete.</p>
<p>Finally, the <a href="qobexpushservice.html#done">done</a>() signal is emitted when the OBEX client disconnects or if the connection is terminated.</p>
<a name="handling-socket-disconnections"></a>
<h3>Handling socket disconnections</h3>
<p>You should ensure that the <a href="./qiodevice.html">QIODevice</a> provided in the constructor emits <a href="./qiodevice.html#aboutToClose">QIODevice::aboutToClose</a>() or <a href="./qobject.html#destroyed">QObject::destroyed</a>() when the associated transport connection is disconnected. If one of these signals are emitted, QObexPushService will know the transport connection has been lost, and will emit <a href="qobexpushservice.html#done">done</a>() (and also <a href="qobexpushservice.html#requestFinished">requestFinished</a>() if a <tt>Put</tt> or <tt>Get</tt> request is in progress) with <tt>error</tt> set to <tt>true</tt>, and <a href="qobexpushservice.html#error">error</a>() will return <a href="qobexpushservice.html#Error-enum">ConnectionError</a>.</p>
<p>This is particularly an issue for socket classes such as <a href="./qtcpsocket.html">QTcpSocket</a> that do not emit <a href="./qiodevice.html#aboutToClose">QIODevice::aboutToClose</a>() when a <tt>disconnected()</tt> signal is emitted. In these cases, QObexPushService will not know that the transport has been disconnected. To avoid this, you can make the socket emit <a href="./qiodevice.html#aboutToClose">QIODevice::aboutToClose</a>() when it is disconnected:</p>
<pre><span class="comment">    //</span> make the socket emit aboutToClose() when disconnected() is emitted
    QObject::connect(socket, SIGNAL(disconnected()), socket, SIGNAL(aboutToClose()));</pre>
<p>Or, if the socket can be discarded as soon as it is disconnected:</p>
<pre><span class="comment">    //</span> delete the socket when the transport is disconnected
    QObject::connect(socket, SIGNAL(disconnected()), socket, SLOT(deleteLater()));</pre>
<hr />
<h2>Member Type Documentation</h2>
<h3 class="fn"><a name="Error-enum"></a>enum QObexPushService::Error</h3>
<p>Defines the possible errors for a push service.</p>
<p><table border="1" cellpadding="2" cellspacing="1" width="100%">
<tr><th width="25%">Constant</th><th width="15%">Value</th><th width="60%">Description</th></tr>
<tr><td valign="top"><tt>QObexPushService::NoError</tt></td><td align="center" valign="top"><tt>0</tt></td><td valign="top">No error has occurred.</td></tr>
<tr><td valign="top"><tt>QObexPushService::ConnectionError</tt></td><td align="center" valign="top"><tt>1</tt></td><td valign="top">The client is unable to send data, or the client-server communication process is otherwise disrupted. If this happens, the state will change to <a href="qobexpushservice.html#State-enum">QObexPushService::Closed</a>.</td></tr>
<tr><td valign="top"><tt>QObexPushService::Aborted</tt></td><td align="center" valign="top"><tt>2</tt></td><td valign="top">The request was aborted (either by the client, or by a call to <a href="qobexpushservice.html#abort">abort</a>()).</td></tr>
<tr><td valign="top"><tt>QObexPushService::UnknownError</tt></td><td align="center" valign="top"><tt>100</tt></td><td valign="top">An error other than those specified above occurred.</td></tr>
</table></p>
<h3 class="fn"><a name="State-enum"></a>enum QObexPushService::State</h3>
<p>Defines the possible states for a push service.</p>
<p><table border="1" cellpadding="2" cellspacing="1" width="100%">
<tr><th width="25%">Constant</th><th width="15%">Value</th><th width="60%">Description</th></tr>
<tr><td valign="top"><tt>QObexPushService::Ready</tt></td><td align="center" valign="top"><tt>0</tt></td><td valign="top">The service is ready to receive requests from an OBEX client. This is the default state.</td></tr>
<tr><td valign="top"><tt>QObexPushService::Connecting</tt></td><td align="center" valign="top"><tt>1</tt></td><td valign="top">A client is connecting.</td></tr>
<tr><td valign="top"><tt>QObexPushService::Disconnecting</tt></td><td align="center" valign="top"><tt>2</tt></td><td valign="top">A client is disconnecting.</td></tr>
<tr><td valign="top"><tt>QObexPushService::Streaming</tt></td><td align="center" valign="top"><tt>3</tt></td><td valign="top">A file transfer operation is in progress.</td></tr>
<tr><td valign="top"><tt>QObexPushService::Closed</tt></td><td align="center" valign="top"><tt>100</tt></td><td valign="top">The service has been closed and cannot process any more requests. The service will change to this state if a client sends a <tt>Disconnect</tt> command, or a <a href="qobexpushservice.html#Error-enum">ConnectionError</a> occurs.</td></tr>
</table></p>
<hr />
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QObexPushService"></a>QObexPushService::QObexPushService ( <a href="./qiodevice.html">QIODevice</a> * <i>device</i>, <a href="./qobject.html">QObject</a> * <i>parent</i> = 0 )</h3>
<p>Constructs an OBEX Push service that uses <i>device</i> for the transport connection. The <i>parent</i> is the <a href="./qobject.html">QObject</a> parent.</p>
<p>The <i>device</i> must be opened, or else the service will be unable to receive any client requests.</p>
<h3 class="fn"><a name="dtor.QObexPushService"></a>QObexPushService::~QObexPushService ()</h3>
<p>Destroys the service.</p>
<h3 class="fn"><a name="abort"></a>void QObexPushService::abort ()&nbsp;&nbsp;<tt> [slot]</tt></h3>
<p>Aborts the current client request if a <tt>Put</tt> or <tt>Get</tt> request is in progress. If the request was successfully aborted, <a href="qobexpushservice.html#requestFinished">requestFinished</a>() will be emitted with <tt>error</tt> set to <tt>true</tt> and <a href="qobexpushservice.html#error">error</a>() will return <a href="qobexpushservice.html#Error-enum">QObexPushService::Aborted</a>.</p>
<p>Due to timing issues, the request may finish before it can be aborted, in which case <a href="qobexpushservice.html#requestFinished">requestFinished</a>() is emitted normally.</p>
<h3 class="fn"><a name="acceptFile"></a><a href="./qiodevice.html">QIODevice</a> * QObexPushService::acceptFile ( const <a href="./qstring.html">QString</a> &amp; <i>name</i>, const <a href="./qstring.html">QString</a> &amp; <i>type</i>, <a href="./qtglobal.html#qint64-typedef">qint64</a> <i>size</i>, const <a href="./qstring.html">QString</a> &amp; <i>description</i> )&nbsp;&nbsp;<tt> [virtual protected]</tt></h3>
<p>Called when a client makes a <tt>Put</tt> request to send a file to this service. The <i>name</i>, <i>type</i>, <i>size</i> and <i>description</i> parameters respectively hold the name, MIME type, size and description of the file, as sent by the client. The <i>size</i> will be 0 if the client did not send any information about the size of the file.</p>
<p>This function can be overridden to intercept the request and determine whether the request should be allowed to continue (for example, by asking the end user, or by checking some file threshold) and where the file data should be saved. To allow the request, return a <a href="./qiodevice.html">QIODevice</a> pointer, and the received file data will be written to this <a href="./qiodevice.html">QIODevice</a>. To refuse the request, return 0.</p>
<p>If the request is allowed to continue, the <a href="qobexpushservice.html#putRequested">putRequested</a>() signal is emitted, and the <a href="qobexpushservice.html#requestFinished">requestFinished</a>() signal will be emitted when the the request has finished. The returned <a href="./qiodevice.html">QIODevice</a> pointer is accessible from <a href="qobexpushservice.html#currentDevice">currentDevice</a>().</p>
<p>The default implementation attempts to save the incoming file into <a href="./qdir.html#homePath">QDir::homePath</a>(), using <i>name</i> as the name of the file. (If <i>name</i> contains a path, only the filename at the end of the path will be used, and if <i>name</i> is an empty string, the file will be saved as &quot;unnamed&quot;.) If the file is successfully created, the <tt>Put</tt> request will be accepted; otherwise, the request will be refused.</p>
<p>See also <a href="qobexpushservice.html#putRequested">putRequested</a>(), <a href="qobexpushservice.html#currentDevice">currentDevice</a>(), <a href="qobexpushservice.html#dataTransferProgress">dataTransferProgress</a>(), and <a href="qobexpushservice.html#requestFinished">requestFinished</a>().</p>
<h3 class="fn"><a name="businessCard"></a><a href="./qbytearray.html">QByteArray</a> QObexPushService::businessCard () const&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Returns the business card that will be sent to OBEX clients who request it, as per the Business Card exchange feature of the Bluetooth Object Push Profile.</p>
<p>See also <a href="qobexpushservice.html#setBusinessCard">setBusinessCard</a>().</p>
<h3 class="fn"><a name="businessCardRequested"></a>void QObexPushService::businessCardRequested ()&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This signal is emitted when an OBEX client has requested the business card from the service, and <a href="qobexpushservice.html#businessCard">businessCard</a>() returns a non-empty <a href="./qbytearray.html">QByteArray</a>. (If <a href="qobexpushservice.html#businessCard">businessCard</a>() returns an empty <a href="./qbytearray.html">QByteArray</a>, the signal is not emitted.)</p>
<p>The <a href="qobexpushservice.html#requestFinished">requestFinished</a>() signal is emitted when the request is completed.</p>
<p>See also <a href="qobexpushservice.html#setBusinessCard">setBusinessCard</a>() and <a href="qobexpushservice.html#businessCard">businessCard</a>().</p>
<h3 class="fn"><a name="currentDevice"></a><a href="./qiodevice.html">QIODevice</a> * QObexPushService::currentDevice () const</h3>
<p>If a <tt>Put</tt> request is in progress, this function returns the <a href="./qiodevice.html">QIODevice</a> pointer that is used to store the data from the request. If there is no <tt>Put</tt> request in progress, this function returns 0.</p>
<p>This function can be used to delete the <a href="./qiodevice.html">QIODevice</a> in the slot connected to the <a href="qobexpushservice.html#requestFinished">requestFinished</a>() signal.</p>
<p>See also <a href="qobexpushservice.html#acceptFile">acceptFile</a>().</p>
<h3 class="fn"><a name="dataTransferProgress"></a>void QObexPushService::dataTransferProgress ( <a href="./qtglobal.html#qint64-typedef">qint64</a> <i>done</i>, <a href="./qtglobal.html#qint64-typedef">qint64</a> <i>total</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This signal is emitted during file transfer operations to indicate the progress of the transfer. The <i>done</i> value is the number of bytes that have been sent or received so far, and <i>total</i> is the total number of bytes to be sent or received.</p>
<p>If the total number of bytes is not known, <i>total</i> will be 0.</p>
<h3 class="fn"><a name="done"></a>void QObexPushService::done ( bool <i>error</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This signal is emitted when the OBEX client has disconnected from the service or if the connection has been terminated. The <i>error</i> value is <tt>true</tt> if an error occurred during the processing; otherwise <i>error</i> is <tt>false</tt>.</p>
<h3 class="fn"><a name="error"></a><a href="qobexpushservice.html#Error-enum">Error</a> QObexPushService::error () const</h3>
<p>Returns the error for the last completed request.</p>
<h3 class="fn"><a name="putRequested"></a>void QObexPushService::putRequested ( const <a href="./qstring.html">QString</a> &amp; <i>name</i>, const <a href="./qstring.html">QString</a> &amp; <i>type</i>, <a href="./qtglobal.html#qint64-typedef">qint64</a> <i>size</i>, const <a href="./qstring.html">QString</a> &amp; <i>description</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This signal is emitted when an OBEX client has made a <tt>Put</tt> request to the service and <a href="qobexpushservice.html#acceptFile">acceptFile</a>() has accepted the request. The <i>name</i>, <i>type</i>, <i>size</i> and <i>description</i> parameters respectively hold the name, MIME type, size and description of the file, as sent by the client. The <i>size</i> will be 0 if the client did not send any information about the size of the file.</p>
<p>The <a href="qobexpushservice.html#requestFinished">requestFinished</a>() signal is emitted when the <tt>Put</tt> request is completed.</p>
<p>See also <a href="qobexpushservice.html#currentDevice">currentDevice</a>().</p>
<h3 class="fn"><a name="requestFinished"></a>void QObexPushService::requestFinished ( bool <i>error</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This signal is emitted when a client <tt>Put</tt> or <tt>Get</tt> request is completed. The <i>error</i> value is <tt>true</tt> if an error occurred during the request; otherwise <i>error</i> is <tt>false</tt>.</p>
<h3 class="fn"><a name="sessionDevice"></a><a href="./qiodevice.html">QIODevice</a> * QObexPushService::sessionDevice () const</h3>
<p>Returns the device used by this OBEX Push server session, as provided in the constructor.</p>
<h3 class="fn"><a name="setBusinessCard"></a>void QObexPushService::setBusinessCard ( const <a href="./qbytearray.html">QByteArray</a> &amp; <i>vCard</i> )</h3>
<p>Sets <i>vCard</i> to be the business card (in vCard format) that will be sent to OBEX clients who request it, as per the Business Card exchange feature of the Bluetooth Object Push Profile.</p>
<p>If no business card is set, this service will refuse all client requests for business cards.</p>
<p>See also <a href="qobexpushservice.html#businessCard">businessCard</a>().</p>
<h3 class="fn"><a name="state"></a><a href="qobexpushservice.html#State-enum">State</a> QObexPushService::state () const</h3>
<p>Returns the current state of the service.</p>
<h3 class="fn"><a name="stateChanged"></a>void QObexPushService::stateChanged ( <a href="qobexpushservice.html#State-enum">QObexPushService::State</a> <i>state</i> )&nbsp;&nbsp;<tt> [signal]</tt></h3>
<p>This signal is emitted when the state of the service changes. The <i>state</i> is the new state of the client.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2008 <a href="trolltech.html">Trolltech</a></td>
<td align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qtopia 4.3.2</div></td>
</tr></table></div></address></body>
</html>
