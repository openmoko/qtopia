<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>SXE - Package Keying and Manifest</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">SXE - Package Keying and Manifest<br /><small></small></h1>
<p>There are three control files governing the install time and run time operation of the SXE with respect to packages and programs.</p>
<p>The table below summarizes the operations of the system with respect to packages and programs.</p>
<p><table align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Name</th><th>Path</th><th>Runtime Access</th><th>Format</th><th>Function</th></tr></thead>
<tr valign="top" class="odd"><td><tt>Keyfile</tt></td><td><tt>$QPEDIR/etc/keyfile</tt></td><td><tt>qpe</tt> (no Qtopia or other programs may access this file)</td><td>Binary file (in <tt>progId</tt> order):<ul>
<li>0-15: uchar key[16]</li>
<li>16: uchar progId</li>
<li>17: pad</li>
<li>18-25: int64 (time_t) key change_time</li>
</ul>
</td><td><ul>
<li>lookup of program keys and ids for application level policy, that is, deny/allow of QCop messages (read-only)</li>
<li>re-keying of programs, periodically (read-write)</li>
<li>one-to-one mapping betw program id &amp; key</li>
</ul>
</td></tr>
<tr valign="top" class="even"><td>Manifest</td><td><tt>$QPEDIR/etc/manifest</tt></td><td><tt>packagemanager</tt>, <tt>qpe</tt></td><td>Binary file (sorted by <tt>dev_id</tt>, <tt>inode</tt>):<ul>
<li>0-7: int64 dev_id</li>
<li>8-15: int64 inode</li>
<li>16: uchar progId</li>
<li>17: pad</li>
<li>18-19: ushort install_id</li>
<li>20-23: uint key offset</li>
<li>20-27: int64 (time_t) install_time</li>
</ul>
</td><td><ul>
<li>re-keying of programs, periodically (<tt>qpe</tt>: read only) ensures programs only keyed once</li>
<li>key offset ensures fast rekey by locating the offset of the key in the binary</li>
<li>adding new programs to <tt>Keyfile</tt> (<tt>qpe</tt>: read only)</li>
<li>recording new programs for policy and uninstall (<tt>packagemanager</tt>: read-write)</li>
<li>several binaries may have the same <tt>progId</tt> (and key)</li>
<li>one-to-one mapping betw binary file on storage &amp; install_id</li>
</ul>
</td></tr>
<tr valign="top" class="odd"><td>Installs</td><td><tt>$QPEDIR/etc/installs</tt></td><td><tt>packagemanager</tt>, <tt>qpe</tt></td><td>Text file (fields ':' separated, records LF separated):<ul>
<li>install_id</li>
<li>full path</li>
</ul>
</td><td><ul>
<li>re-keying of programs, periodically (<tt>qpe</tt>: read only) gives mapping of inode to path for ::open(3)</li>
<li>recording for uninstall (<tt>packagemanager</tt>: read-write)</li>
<li>note the path may be a symlink or hard link so one install_id may have several paths</li>
</ul>
</td></tr>
</table></p>
<a name="rekeying"></a>
<h2>Rekeying</h2>
<p>SXE relies on <b>shared secrets</b> which is the principle that a key is kept secret to the server process <tt>qpe</tt> and to the program owning the key. No other program should know or discover that key. The key is simply a long number generated randomly.</p>
<p>One way to attack this system is to try to guess the secret key.</p>
<p>SXE keys are 128 bit and trying all possible keys would take thousands of years even assuming a very fast processor.</p>
<p>Since a key guessing (&quot;brute-force&quot;) attack is not feasible, a common attack is to discover information about the random number in the key.</p>
<p>If the attacking downloaded program has some information about the /dev/random device, this means only a smaller subset of numbers needs to be tried. In this case we say the effective <b>entropy</b> of the random number generator (RNG) has been reduced.</p>
<p>If it is possible to attack the RNG in this way, that constitues a flaw in the security of the product, most likely at the OS level; and is a bug that needs to be fixed.</p>
<p>As a second line of defence, to mitigate the risk of an exploit of an RNG bug (or a similar security flaw), keys are changed periodically. The period is governed by the macro QSXE_KEY_PERIOD and it is not recommended to change it from the default of approximatley 2.6 days.</p>
<p>As an example, if an attack on RNG reduces the entropy from 128 bits to 40, and the attack program is able to try 10 keys a millisecond, then the chance of a successful trial in a 2.6 day period is: ( 10000 x 60 x 60 x 24 x 2.6 ) / ( 2 ** 40 ) = 0.2%.</p>
<p>Without rekeying that figure increments by 0.2% on each period. The expected outcome (for an average device over a large number of devices) is that the attack program would find the key when the figure reaches 50% ie in 636 days. Alternatively, for every 1000 devices attacked by the program the expected outcome is that approx 3 devices would be compromised every 2 days.</p>
<p>With rekeying there is no relationship between trials in successive periods so the probability of a successful attack does not grow larger than the 0.2% for any given period, despite the exploit on the security flaw in the RNG.</p>
<p>In the case of a device with a unique id number, such as a GSM phone's IMEI number the process keys are further hashed with the key. This makes blanket attacks - where large number of end-user devices receive a malicious program - much more difficult since obtaining the IMEI number is a privileged operation.</p>
<p>Rekeying also means that if a rogue program somehow manages to obain a key and is is not discovered it will only be able to operate until the key is changed.</p>
<p>If a Read-only file system such as cramfs is used to store program binaries, or they are for some other reason read-only, then it is not possible to rekey those binaries.</p>
<p>Instead the new key is written into a .rekey file inside the directory $QPEDIR/etc/sxe. This directory must be protected by a LIDS policy where each program <tt>progname</tt> only has read-only access to <tt>$QPEDIR/etc/sxe/$progname.rekey</tt>.</p>
<p>This makes the security policy more complex, and therefore theoretically less secure. It is preferable that the Qtopia binaries can be stored on a writeable file-system, but SXE will still work with a read-only filesystem.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2007 <a href="trolltech.html">Trolltech</a></td>
<td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">Qtopia 4.2.1</div></td>
</tr></table></div></address></body>
</html>
