<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Bluetooth Service Management Framework</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">Bluetooth Service Management Framework<br /><small></small></h1>
<a name="top"></a><a name="introduction"></a>
<h2>Introduction</h2>
<p>Qtopia's Bluetooth infrastructure includes a framework for creating and managing Bluetooth services inside Qtopia. This framework allows Bluetooth services to be handled consistently within Qtopia. It also provides mechanisms to allow programmers to easily create and register custom Bluetooth services within the framework, and control and configure existing Bluetooth services.</p>
<p>To create and register a custom Bluetooth service within this framework, simply subclass <a href="qbluetoothabstractservice.html">QBluetoothAbstractService</a>. The service will then be treated as any other Qtopia system Bluetooth service, which means:</p>
<ul>
<li>The end user will be able to configure it through the Qtopia Bluetooth settings application (under &quot;Local Services&quot;)</li>
<li>You will be able to control it programmatically through an instance of <a href="qbluetoothservicecontroller.html">QBluetoothServiceController</a></li>
<li>Some persistent settings for the service will be stored in the BluetoothServices.conf configuration file, and these settings can be modified to define default settings for the service without recompilation</li>
</ul>
<a name="architecture"></a>
<h3>Architecture</h3>
<p>It is not necessary to understand the architecture of the framework to create a custom Bluetooth service or access information about existing services. However, this may be useful if you need to delve into the source code.</p>
<p>Essentially, there are three distinct components in the framework, as shown in this diagram:</p>
<p align="center"><img src="images/bluetooth-servicemanager_architecture.png" /></p><p>At the core is the <b>Bluetooth Service Manager</b>. This manager is created as a Qtopia task by QPE at start-up and thus is always present. It takes the central role within the framework; it is contacted whenever a Qtopia Bluetooth services is started, stopped, etc. and acts upon requests by external parties to start and stop services. It communicates with other components within the framework using Qtopia's Interprocess Communication (IPC) mechanisms.</p>
<p>The service manager is also responsible for storing and loading persistent service settings in the <tt>BluetoothServices.conf</tt> configuration file. A default configuration file is provided at <tt>etc/default/Trolltech/BluetoothServices.conf</tt>. This can be modified to provide default settings for services.</p>
<p>Each <b>Qtopia Bluetooth service</b> has a two-way communication link with the Bluetooth Service Manager. A service notifies the manager when significant service events have occured, such as when the service has started or stopped. The manager notifies a service when it should perform a particular operation, such as when the service should be started or stopped. A service should not start or stop by itself, so that the service manager can control and track the state of the service. (The service manager will automatically tell a service to start when it is created.)</p>
<p>All communication between the Bluetooth services and the service manager is handled internally within <a href="qbluetoothabstractservice.html">QBluetoothAbstractService</a>. When a custom Bluetooth service is created by subclassing <a href="qbluetoothabstractservice.html">QBluetoothAbstractService</a>, all IPC communication aspects will be initialised transparently, and communication with the service manager will appear to the custom class as signals and method invocations. (The IPC aspects are handled by QBluetoothServiceControl and QBluetoothServiceControlServer, which use the IPC <a href="qabstractipcinterface.html">QAbstractIpcInterface</a> essentially provided by <a href="qabstractipcinterface.html">QAbstractIpcInterface</a> and its associated classes.)</p>
<p>Finally, the <a href="qbluetoothservicecontroller.html">QBluetoothServiceController</a> class in the Bluetooth library provides <b>service access for external parties</b>. The interface of this class allows interested parties to control a Bluetooth service (e.g. start or stop it) or access information about the service (e.g. its security options or state). For example, Qtopia's Bluetooth settings application uses this class to start and stop any Qtopia Bluetooth service and modify its security settings. For IPC, the <a href="qbluetoothservicecontroller.html">QBluetoothServiceController</a> class uses the <a href="qtopiaipcadaptor.html">QtopiaIpcAdaptor</a> class to communicate service control requests to the Bluetooth service manager.</p>
<a name="creating-a-custom-bluetooth-service"></a>
<h3>Creating a custom Bluetooth service</h3>
<p>To create a custom Qtopia Bluetooth service, subclass <a href="qbluetoothabstractservice.html">QBluetoothAbstractService</a> and implement the details for your service accordingly. See the <a href="qbluetoothabstractservice.html">class documentation</a> for an example of implementing a custom Bluetooth service.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2007 <a href="trolltech.html">Trolltech</a></td>
<td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">Qtopia 4.2.1</div></td>
</tr></table></div></address></body>
</html>
