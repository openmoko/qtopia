<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Document System: DRM Integration</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="groups.html"><font color="#004faf">Grouped Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">Document System: DRM Integration<br /><span class="subtitle"></span>
</h1>
<ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#rendering-drm-content">Rendering DRM Content</a></li>
<li><a href="#downloading-and-receiving-drm-files">Downloading and Receiving DRM Files</a></li>
<li><a href="#drm-standards-compliance">DRM Standards Compliance</a></li>
</ul>
<a name="introduction"></a>
<h2>Introduction</h2>
<p>Files and content subject to DRM are transparently browsed, launched, moved, deleted and examined for their properties, in the same way as other files. Additionally DRM rights are able to be viewed as part of the properties of a file. Icons have an adornment to indicate that, in addition to their mime-type, the file is a DRM controlled file.</p>
<p>DRM integration requires that:</p>
<ul>
<li>DRM content be presented transparently alongside non-DRM content</li>
<li>back-end abstraction layer provides hooks into the DRM agent</li>
<li>DRM standards compliance statements must be honored by the implementation</li>
<li>DRM transactions provide triggers into the server to update with new content</li>
<li>meta-information is extracted from encrypted DRM files using agent calls, and cached as appropriate.</li>
</ul>
<p>The DRM architecture is shown in the following diagram:</p>
<p align="center"><img src="images/drm-arch.png" alt="DRM Architecture" /></p><a name="rendering-drm-content"></a>
<h2>Rendering DRM Content</h2>
<p>Constraints may be placed on the rendering of DRM content restricting thing such as the number of times and the time in which the content may be rendered so in order to comply with these constraints there are some additional steps that must be when rendering protected content.</p>
<p>First to acquire access to a DRM protected file a license must be requested using the <a href="qdrmcontent.html">QDrmContent</a> class, if there are current rights for the file a license will be granted immediately, if not the user may be prompted to download a license or visit a web site. Once a license has been granted the plain-text content of DRM protected files may be accessed using the standard Qt file API or the file access methods of <a href="qcontent.html">QContent</a>. When access is to the file is no longer required the license should be released which will prevent any further access to the content.</p>
<p>Once a license has been granted and file access is available it is necessary to update the constraints of the protected file as it is rendered. This is performed using calls to <a href="qdrmcontent.html#renderStarted">QDrmContent::renderStarted</a>(), <a href="qdrmcontent.html#renderPaused">QDrmContent::renderPaused</a>(), and <a href="qdrmcontent.html#renderStopped">QDrmContent::renderStopped</a>() on the <a href="qdrmcontent.html">QDrmContent</a> instance the license for the file was requested from. The agent will time these calls and count the number of times rendering is started and update the constraints. If rights to the file expire while it is being rendered <a href="qdrmcontent.html">QDrmContent</a> will emit a rights expired signal notifying the application it should release its license and stop rendering the content.</p>
<a name="downloading-and-receiving-drm-files"></a>
<h2>Downloading and Receiving DRM Files</h2>
<p>Received DRM files may be content files, or rights objects or triggers. DRM content files is saved to the file system and registered with the document system like any other content. The preferred method of saving content is to construct a new <a href="qcontent.html">QContent</a> and assign it the name and type of the received file and then write the file to the <a href="qcontent.html">QContent</a> using either the <a href="qcontent.html#save">QContent::save</a>() or by opening a write only <a href="qiodevice.html">QIODevice</a> using <a href="qcontent.html#open">QContent::open</a>() and writing to it. If the IO device is used it is important to commit the <a href="qcontent.html">QContent</a> after closing the IO device to ensure the <a href="qcontent.html">QContent</a> is saved.</p>
<p>If the file is rights object or trigger it shouldn't be saved to the file system, instead a <a href="datasharing.html">Qtopia Data Sharing (QDS)</a> service which handles the type of the file should be invoked. File types that should be handled in this manner can be identified by performing a search for a service with the request type that of the recieved file, no response type and the attribute 'handle', the 'drm' attribute may also optionally be used to only invoke services for DRM file types.</p>
<p>The example below checks for a service which handle the mime type of received data and invokes it if found, if not found it saves the data and invokes the default application for handling it.</p>
<pre>    void receive( const QString &amp;name, const QString &amp;type, const QByteArray &amp;data )
    {
        <span class="comment">// First check if the mime type is handled by a QDS service.</span>
        QDSServices services( type, QString(), QStringList() &lt;&lt; &quot;handle&quot; );

        if( !services.isEmpty() )
        {
            QDSServiceInfo service = services.first();

            QDSAction action( service );

            action.exec( QDSData( data, QMimeType( type ) ) );
        }
        else <span class="comment">// Not handled by a QDS service so save to the file system and open in the default application.</span>
        {
            QContent content;

            content.setName( name );
            content.setType( type );
            content.save( data );
            content.commit();  <span class="comment">// Not really necessary in this case as save() will call commit() after writing the data.</span>
            content.execute();
        }
    }</pre>
<p>Some DRM format such as OMA DRM messages need to be converted to a localised format when they are received, the Qtopia document system will perform this automatically when the data is saved to the file system using <a href="qcontent.html">QContent</a>. If an application does not intend to save the received data directly to the file system for whatever reason QDS services are provided to convert the data to the localised format. The QDS signature for these services is the same as for handling rights objects and triggers except it also has a response type.</p>
<a name="drm-standards-compliance"></a>
<h2>DRM Standards Compliance</h2>
<p>DRM complies with the <a href="http://www.openmobilealliance.org">Open Mobile Alliance (OMA) Version 1.0</a>. When the Qtopia stack is released, a DRM compliance statement is made as part of the release. The Qtopia software integrated into a final ROM image implements compliance with DRM standards as per the compliance statement.</p>
<p>In OMA DRM compliance, compliance with the later-listed compliance points requires compliance with all previous levels as well. When reading the listings of compliance levels below, bear in mind that each level includes rather than supersedes the previous levels.</p>
<p>The only exception to this for devices which support <i>Forward Lock</i>. These are only required to discard messages which contain a rights object. This requirement is removed at higher levels.</p>
<p>Under OMA DRM Version 1.0 devices which only comply with <i>Forward Lock</i> provisions can still be said to be standards compliant - these are the only provisions with the MUST keyword, the others are MAY. <i>Forward Lock</i> does not use any rights object and thus is the simplest to implement.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2007 <a href="trolltech.html">Trolltech</a></td>
<td align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qtopia 4.2.4</div></td>
</tr></table></div></address></body>
</html>
