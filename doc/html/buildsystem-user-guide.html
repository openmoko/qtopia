<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Build System User Guide</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qpelogo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="annotated.html"><font color="#004faf">Annotated</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 align="center">Build System User Guide<br /><small></small></h1>
<p>This document is designed for anyone working with the Qtopia build system. It is used in conjunction with the <a href="buildsystem-reference.html">Build System Reference</a> which describes individual items in more detail and the <a href="buildsystem-internals.html">Build system Internals</a> document that provides additional developer-oriented information.</p>
<ul><li><a href="#terminology">Terminology</a></li>
<li><a href="#overview">Overview</a></li>
<ul><li><a href="#what-has-changed">What has Changed?</a></li>
<li><a href="#what-is-the-build-system">What is the Build System?</a></li>
<li><a href="#platform-support">Platform Support</a></li>
<li><a href="#depot-hopping">Depot Hopping</a></li>
</ul>
<li><a href="#features">Features</a></li>
<ul><li><a href="#dependencies">Dependencies</a></li>
<li><a href="#applications">Applications</a></li>
<li><a href="#libraries">Libraries</a></li>
<li><a href="#plug-ins">Plug-ins</a></li>
<li><a href="#subdirs">subdirs</a></li>
<li><a href="#install-helpers">Install Helpers</a></li>
<li><a href="#packages">Packages</a></li>
<li><a href="#internationalization">Internationalization</a></li>
<li><a href="#non-code-translatables">Non-code Translatables</a></li>
</ul>
<li><a href="#tasks">Tasks</a></li>
<ul><li><a href="#setting-up-headers">Setting Up Headers</a></li>
<li><a href="#setting-up-a-global-condition">Setting up a Global Condition</a></li>
<li><a href="#deciding-what-to-build">Deciding What To Build</a></li>
</ul>
<li><a href="#common-makefile-targets">Common Makefile Targets</a></li>
<li><a href="#device-configuration-profiles">Device Configuration Profiles</a></li>
<li><a href="#features">Features</a></li>
<ul><li><a href="#configure">configure</a></li>
<li><a href="#environment">environment</a></li>
<li><a href="#mkspecs">mkspecs</a></li>
<li><a href="#custom-h-custom-cpp">custom.h/custom.cpp</a></li>
<li><a href="#defaultbuttons-conf">defaultbuttons.conf</a></li>
<li><a href="#config-pri">config.pri</a></li>
<li><a href="#projects-pri">projects.pri</a></li>
<li><a href="#src">src</a></li>
<li><a href="#qconfig-h">qconfig.h</a></li>
<li><a href="#storage-conf">Storage.conf</a></li>
<li><a href="#limitations">Limitations</a></li>
</ul>
</ul>
<a name="terminology"></a>
<h2>Terminology</h2>
<p><table width="100%" align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Term</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td>Qt</td><td><ul>
<li>The name of Trolltech's GUI toolkit for desktop systems.</li>
<li>This is also referred to as Qt (host) and <tt>qtopiacore</tt> (host).</li>
</ul>
</td></tr>
<tr valign="top" class="even"><td>Qtopia Core</td><td><ul>
<li>The name given to Qt when it is run on embedded Linux systems.</li>
<li>Features additional functionality not present in the desktop version.</li>
<li>It does not run under an existing windowing system.</li>
<li>This was previously known as Qt/Embedded.</li>
<li>This is also referred to as Qt (target) and <tt>qtopiacore</tt> (target).</li>
</ul>
</td></tr>
<tr valign="top" class="odd"><td>source tree</td><td><ul>
<li>Where source code is located. This can be the same as the build tree.</li>
</ul>
</td></tr>
<tr valign="top" class="even"><td>build tree</td><td><ul>
<li>Where build files are located. This can be the same as the source tree.</li>
</ul>
</td></tr>
<tr valign="top" class="odd"><td>project root</td><td><ul>
<li>The Qtopia source tree is split into a number of areas called project roots.</li>
<li>Generally, files are found relative to a project root.</li>
</ul>
</td></tr>
<tr valign="top" class="even"><td>project</td><td><ul>
<li>A project is a directory that contains a .pro file.</li>
<li>Typically represents an application, library or plug-in to be built.</li>
</ul>
</td></tr>
<tr valign="top" class="odd"><td>internal project</td><td><ul>
<li>This is a project inside the Qtopia tree.</li>
</ul>
</td></tr>
<tr valign="top" class="even"><td>external project</td><td><ul>
<li>This is a project outside the Qtopia tree.</li>
</ul>
</td></tr>
</table></p>
<p><b>Note:</b> Qt and Qtopia Core share the same sources but must be built as two separate products, even when building for the desktop.</p>
<a name="overview"></a>
<h2>Overview</h2>
<a name="what-has-changed"></a>
<h3>What has Changed?</h3>
<p>If you have used earlier Qtopia releases there are some significant changes to how the build system works as follows:</p>
<ul>
<li>Manually running <tt>qmake</tt> is no longer supported. All application development <b>must</b> be enabled via <tt>configure</tt> or <tt>qtopiamake</tt>.</li>
<li><tt>make</tt> cannot be run from within the <tt>&lt;source_tree&gt;/qtopiacore</tt> or <tt>&lt;build_tree&gt;/qtopiacore</tt> directories. Qtopia manages these directories and when running <tt>make</tt> manually, environment variables may not be set correctly resulting in incorrect directories being used for the build.</li>
<li>Dependency information is obtained from the project you depend on (much easier to maintain <b>and</b> we get a dependency overview for free).</li>
<li><tt>config.pri</tt> and <tt>global.pri</tt> are split into many pieces (due to <tt>qmake</tt>'s support for features - implicitly loaded <tt>.prf</tt> files).</li>
<li>Environment variables no longer need to be set. The exception to this rule is <tt>QPEDIR</tt> which is only required when running scripts.</li>
<li>Qtopia builds Qt and Qtopia Core projects from the following locations:<ul>
<li><tt>src/libraries/qt/*</tt></li>
<li><tt>src/tools/qt/*</tt></li>
<li><tt>src/plugins/qt</tt></li>
<li><tt>src/libraries/qtopiacore/*</tt></li>
<li><tt>src/tools/qtopiacore/*</tt></li>
<li><tt>src/plugins/qtopiacore</tt></li>
<li><tt>src/plugins/qtopiacore/*</tt> (singleexec wrappers for image plug-ins)</li>
</ul>
</li>
</ul>
<a name="what-is-the-build-system"></a>
<h3>What is the Build System?</h3>
<p>For definition purposes, the build system comprises the following files:</p>
<p><table width="100%" align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>File</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td><tt>configure</tt></td><td>The initial entry point into the build system used to set up the build tree.</td></tr>
<tr valign="top" class="even"><td><tt>bin/qtopiamake</tt></td><td>Called by <tt>configure</tt> and doubles as the the initial entry point for external projects.</td></tr>
<tr valign="top" class="odd"><td><tt>bin/*.pm</tt></td><td>Support modules for the perl scripts that comprise the build system.</td></tr>
<tr valign="top" class="even"><td><tt>Makefile</tt></td><td>Second entry point into the build system. Makefiles are created by <tt>qtopiamake</tt>.</td></tr>
<tr valign="top" class="odd"><td><tt>Makefile.target</tt></td><td>File created by <tt>qmake</tt> for each project. It should not be called directly.</td></tr>
<tr valign="top" class="even"><td><tt>*.pro</tt></td><td>File read by <tt>qmake</tt> when it makes <tt>Makefile.target</tt>. There is one of these files for each project.</td></tr>
<tr valign="top" class="odd"><td><tt>*.prf</tt></td><td>Features files that can be loaded explicitly but are typically loaded implicitly.</td></tr>
<tr valign="top" class="even"><td><tt>*.pri</tt></td><td>These are miscellaneous build system files included from <tt>.pro</tt> or <tt>.prf</tt> files.</td></tr>
</table></p>
<a name="platform-support"></a>
<h3>Platform Support</h3>
<p>Qtopia builds on Linux using GNU <tt>make</tt>. It should not be difficult to build on other Unix-like systems, though non-GNU <tt>make</tt> utilities might be a problem and due to assumptions made in the build system, building under Cygwin may prove difficult. Building without a <tt>make</tt> tool that is, <tt>qmake</tt>'s <a href="deployment-mac.html#xcode">XCode</a>/Visual Studio project generation is not possible as parts of the the build system functionality are based on running Makefiles.</p>
<a name="depot-hopping"></a>
<h3>Depot Hopping</h3>
<p>When editing source files and shadow building (that is, build tree != source tree) you may be interested in depot hopping. Simply set <tt>QPEDIR</tt> to the location of your build tree and the Makefiles that <tt>qtopiamake</tt> puts in the source tree will call through to those in the build tree. For example:</p>
<pre>    cd /path/to/build
    export QPEDIR=$PWD
    cd /path/to/source/examples/application
    $QPEDIR/bin/qtopiamake # sets up shadow build to $QPEDIR/examples/application
    make # build in $QPEDIR/examples/application</pre>
<a name="features"></a>
<h2>Features</h2>
<a name="dependencies"></a>
<h3>Dependencies</h3>
<p>The Qtopia build system has dependency information embedded into the <tt>.pro</tt> files. This makes it possible to build everything in the most efficient way as well as providing flexibility. For example, a library can be renamed with a single change in a single file whereas without the dependency system, many files would need to be changed. The dependency information also provides the ability to graph interdependencies between projects as well as dependencies on external libraries.</p>
<p><b>Note:</b> Do not put <tt>LIBS+=</tt> or <tt>INCLUDEPATH+=</tt> lines in your <tt>.pro</tt> files, use <tt>depends()</tt> instead. This applies even if you need to depend on something that isn't built (ie. part of the system). Simply create a <tt>stub</tt> project with <tt>dep()</tt> commands. This keeps dependencies clearly defined.</p>
<p>If your application can handle a missing dependency you should do something like this:</p>
<pre>    contains(PROJECTS,mydep):CONFIG+=enable_mydep
    enable_mydep:depends(mydep)
    else:DEFINES+=QTOPIA_NO_MYDEP</pre>
<p>Use the presence or absence of <tt>enable_mydep</tt> in the <tt>.pro</tt> file. For example, disable whole files that use the dependency. Use the presence or absence of <tt>QTOPIA_NO_MYDEP</tt> to handle code that interfaces with the dependency.</p>
<p>For information about how to use the dependency system please refer to the <a href="buildsystem-reference.html#dep"><tt>dep()</tt></a>, <a href="buildsystem-reference.html#idep"><tt>idep()</tt></a> and <a href="buildsystem-reference.html#depends"><tt>depends()</tt></a> functions.</p>
<a name="applications"></a>
<h3>Applications</h3>
<p>Qtopia applications can be built in one of four ways:</p>
<ol type="1">
<li>quicklaunch</li>
<li>non-quicklaunch</li>
<li>singleexec (quicklaunch)</li>
<li>singleexec (non-quicklaunch)</li>
</ol>
<p>To facilitate switching between build modes, Qtopia provides two macros which are used as follows:</p>
<pre>    #include &quot;myheader.h&quot;
    #include &lt;QtopiaApplication&gt;

    QTOPIA_ADD_APPLICATION(QTOPIA_TARGET, MyMainClass)
    QTOPIA_MAIN</pre>
<p>The first argument to <tt>QTOPIA_ADD_APPLICATION()</tt> <b>must</b> be a literal string that matches the binary name that is, the value of <tt>TARGET</tt> from the <tt>.pro</tt> file. The build system defines <tt>QTOPIA_TARGET</tt> with the value of <tt>TARGET</tt> and it is recommended to use this macro.</p>
<p>The second argument to <tt>QTOPIA_ADD_APPLICATION()</tt> should be the name of your class. If you use the wrong value you will get a compile failure.</p>
<p>Building for either <tt>quicklaunch</tt> or <tt>singleexec</tt> (quicklaunch) <b>requires</b> these macros but the build system cannot easily determine if you have used them and the penalty for a wrong guess could be disastrous. Therefore you must use the <tt>qtopia_main</tt> <tt>CONFIG</tt> value if you use these macros or the build system will assume your application is not quicklaunch-compatible. If your application does not handle <tt>quicklaunch</tt> or is <tt>singleexec</tt> you can use the <tt>no_quicklaunch</tt> or <tt>no_singleexec</tt> <tt>CONFIG</tt> values.</p>
<p>For example, games do not need the speed benefits of <tt>quicklauncher</tt> (and there is a size penalty for using quicklauncher) but they do work with <tt>singleexec</tt>. So use <tt>CONFIG+=qtopia_main no_quicklaunch</tt> to indicate this.</p>
<p>Some applications, such as those using a custom application class, cannot use the macros. Tis prevents the use of <tt>quicklauncher</tt> but you can still work with <tt>singleexec</tt> if you make some changes to your code. You need to use the <tt>singleexec_main</tt> <tt>CONFIG</tt> value and have a <tt>main.cpp</tt> similar to the following:</p>
<pre>    #include &quot;myheader.h&quot;
    #include &lt;QtopiaApplication&gt;

    #ifdef SINGLE_EXEC
    QTOPIA_ADD_APPLICATION(QTOPIA_TARGET, MyMainClass)
    #define MAIN_FUNC main_MyMainClass
    #else
    #define MAIN_FUNC main
    #endif

    int MAIN_FUNC( int argc, char **argv )
    {
        MyApplication a( argc, argv );
        MyWidget w;
        w.show();
        return a.exec();
    }</pre>
<a name="libraries"></a>
<h3>Libraries</h3>
<p>Library projects <tt>.pro</tt> files require extra code to make them usable by other projects, for example:</p>
<pre>    qtopia_project(lib)
    TARGET=mylib

    PREFIX=MYLIB
    MYLIB_FORMS=foobase.ui
    MYLIB_HEADERS=foo.h
    MYLIB_PRIVATE_HEADERS=foo_p.h
    MYLIB_SOURCES=foo.cpp

    resolve_include()

    mylib_headers.files=$$MYLIB_HEADERS
    mylib_headers.path=/include/qtopia/mylib
    mylib_headers.hint=headers
    INSTALLS+=mylib_headers

    mylib_private_headers.files=$$MYLIB_PRIVATE_HEADERS
    mylib_private_headers.path=/include/qtopia/mylib/private
    mylib_private_headers.hint=headers
    INSTALLS+=mylib_private_headers

    idep(LIBS+=-l$$TARGET)
    qt_inc($$TARGET)</pre>
<p>This project is a library project called <tt>mylib</tt>. The use of <tt>PREFIX</tt>, <tt>MYLIB_*</tt> and <tt>resolve_include()</tt> is not strictly required but will help if the library needs to be extended later.</p>
<p>There are some install rules created and <tt>qt_inc()</tt> is used to setup the headers. See <a href="#setting-up-headers">Setting Up Headers</a> for details.</p>
<p>The use of <tt>idep()</tt> ensures that dependent projects will be linked to this library.</p>
<a name="plug-ins"></a>
<h3>Plug-ins</h3>
<p>External plug-ins will need to set the <a href="buildsystem-reference.html#plugin-type">plugin_type</a> variable so that the build system knows what type of plug-in they are.</p>
<a name="subdirs"></a>
<h3>subdirs</h3>
<p>A project that uses the keyword <tt>subdirs</tt> to <tt>qtopia_project()</tt> will cause other directories to be built. The project at the top of each project root specifies a value for <tt>subdirs</tt>, however there are many projects that do not and <tt>subdirs</tt> projects that are inside a project root will cause part of the tree to be built. It is also possible to build all directories (instead of those listed in <tt>PROJECTS</tt>) by using the <tt>build_all_dirs</tt> <tt>CONFIG</tt> value. This is superior to using recursive <tt>subdirs</tt> as it allows dependencies to be processed.</p>
<a name="install-helpers"></a>
<h3>Install Helpers</h3>
<p>To simplify the code required in each <tt>.pro</tt> file and to aid installation, common functionality has been moved into the build system. This is mostly visible through the use of <a href="buildsystem-reference.html#install-hints">Install Hints</a> and is assisted by the use of the <tt>EXTRA_TS_FILES</tt> variable.</p>
<a name="packages"></a>
<h3>Packages</h3>
<p>Qtopia projects are automatically setup to be built into packages, and by default these are single packages. Non-qtopia projects must add <tt>packages</tt> to their <tt>CONFIG</tt> to be built into packages. The package contents are the result of running <tt>make install</tt>. To configure the default package you should use the <tt>pkg</tt> structure, for example:</p>
<pre>    pkg.name=myapp
    pkg.desc=My Great App
    pkg.version=1.0</pre>
<p>You can create other structures and assign them to the <tt>PACKAGES</tt> variable to create more than one package though this is not well tested. The structure of a packaging structure is as follows:</p>
<pre>    # struct package {
    #     name       # eg. $name.ipk
    #     desc       # one line summary
    #     domain     # SXE security domains
    #     deps       # packages that this ipk depends on
    #     multi      # additional projects that should be included in this package
    #     version    # package version
    #     license    # package license
    #     maintainer # package maintainer
    #     targets    # targets to run (ie. install stuff)
    # }</pre>
<p>The use of <tt>pkg</tt> structure is suppressed by adding the <tt>no_pkg CONFIG</tt> value. This is useful for multi-project packages, for exmaple, several network-related projects are put into one package. To improve maintainability, you should indicate which project is responsible for packaging if you do this, for example:</p>
<pre>    # Packaged by settings/network
    CONFIG+=no_pkg</pre>
<a name="internationalization"></a>
<h3>Internationalization</h3>
<p>The build system has a variable named <tt>TRANSLATABLES</tt> that is used to facilitate a single set of translations across a number of products and configurations. Conditional source should be added to the <tt>TRANSLATABLES</tt> variable even if the condition is false.</p>
<a name="non-code-translatables"></a>
<h3>Non-code Translatables</h3>
<p><a href="buildsystem-reference.html#nct">Non-code Translatables</a> are processed with <tt>bin/nct_lupdate</tt> which extracts data from the following formats:</p>
<p><table width="100%" align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Format</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td><tt>zone.tab</tt></td><td>A special case used to extract city names from the time zone database</td></tr>
<tr valign="top" class="even"><td><tt>QSettings</tt></td><td>Format for Qtopia configuration files that deal with translated values.</td></tr>
</table></p>
<p>The following is an example of a translatable settings file:</p>
<pre>    [Translation]
    File=QtopiaApplications
    Context=Calendar
    Comment[Desktop Entry/Name]=Use soft hyphen (char U00AD) to indicate hyphenation
    [Desktop Entry]
    Comment[]=A Calendar and Scheduling Program
    Exec=datebook
    Icon=datebook/DateBook
    Type=Application
    Name[]=Cal\xad\x65n\xad\x64\x61r
    MimeType=text/x-vcalendar</pre>
<p>In the above <tt>datebook.desktop</tt> example,the important parts are the <tt>[Translation]</tt> section and the <tt>Var[]=Value</tt> lines.</p>
<p><table align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Code Line</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td><tt>File=QtopiaApplications</tt></td><td>Instructs the build system to store the translations in a file called <tt>QtopiaApplications.ts</tt>. The files in Qtopia are generally stored in global <tt>.ts</tt> files but third-party applications need to use their own files.</td></tr>
<tr valign="top" class="even"><td><tt>Context=Calendar</tt></td><td>Specifies the context to use for the translations. When <tt>QObject::tr()</tt> is called an implicit context is used, however, <tt>QApplication::translate()</tt> allows the context to be set. This must be somewhat unique so that translators do not have to deal with unrelated strings when translating content.</td></tr>
<tr valign="top" class="odd"><td><tt>Comment[Desktop Entry/Name]=Use soft hyphen</tt> <tt>(char U00AD) to indicate hyphenation</tt></td><td>Places a comment in the <tt>.ts</tt> file for translators. In this case, the value <tt>Name</tt> in the <tt>[Desktop Entry]</tt> section is given a comment.</td></tr>
<tr valign="top" class="even"><td><tt>Name[]=Cal\xad\x65n\xad\x64\x61r</tt></td><td>When Qtopia reads this value, it will try to translate it.</td></tr>
</table></p>
<a name="tasks"></a>
<h2>Tasks</h2>
<a name="setting-up-headers"></a>
<h3>Setting Up Headers</h3>
<p>The header setup process is a little complicated. The following is a step-by-step process:</p>
<ol type="1">
<li><tt>configure</tt> runs and<ul>
<li>removes the <tt>include</tt> directory</li>
<li>runs <tt>qmake</tt> over library projects so that their headers are installed.</li>
</ul>
</li>
<li>The <a href="buildsystem-reference.html#headers">headers</a> install rules setup classic headers (Qtopia 2 style) based on the <tt>.path</tt> value and Qt 4 style headers to keep old source working. <b>Note:</b> Their use is deprecated and they will be removed in a future version.</li>
<li>The Qt 4 style headers are installed into a directory named after <tt>TARGET</tt>.</li>
<li>Libraries should use the <tt>qt_inc()</tt> function so that their dependents have this directory added to the <tt>INCLUDEPATH</tt> automatically.</li>
</ol>
<p><b>Note:</b> It is possible to use <tt>idep(INCLUDEPATH+=$$PWD)</tt> but this is not recommended as you cannot limit the files accessible when this method is used. You also cannot keep private headers separated from public headers.</p>
<a name="setting-up-a-global-condition"></a>
<h3>Setting up a Global Condition</h3>
<p>Place the following code in the <tt>optvar</tt> section of <tt>configure</tt>:</p>
<pre>    set_optvar( &quot;myopt&quot;, +{
        &quot;set&quot; =&gt; [ &quot;%&quot;, &quot;Enable myopt.&quot; ],
        &quot;unset&quot; =&gt; [ &quot;no-%&quot;, &quot;Disable myopt.&quot; ],
        &quot;default&quot; =&gt; 1,
        &quot;visible&quot; =&gt; $qtopia_visref,
        &quot;autodep&quot; =&gt; $qtopia_autoref,
    });</pre>
<p>Place the following code in the <tt>config_pri</tt> section of <tt>configure</tt>:</p>
<pre>    if ( opt(&quot;myopt&quot;) ) {
        print CONFIG_PRI &quot;CONFIG+=enable_myopt\n&quot;;
    }</pre>
<p>Place the following code in <tt>src/build/qtopia.prf</tt>:</p>
<pre>    # positive define (preferred)
    enable_myopt:DEFINES+=QTOPIA_MYOPT
    # negative define (to match the QT_NO_ style)
    !enable_myopt:DEFINES+=QTOPIA_NO_MYOPT</pre>
<p><b>Note:</b> The use of a positively-worded option. It is much easier to determine what code does when the options are positively worded.</p>
<a name="deciding-what-to-build"></a>
<h3>Deciding What To Build</h3>
<p>The file <tt>projects.pri</tt> includes other files to setup the <tt>PROJECTS</tt> and <tt>THEMES</tt> variables which control what is built.</p>
<p>The following files are included from <tt>src</tt> in the source tree:</p>
<p><table width="100%" align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>File</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td>general.pri</td><td>Projects and themes that are in all Qtopia source packages.</td></tr>
<tr valign="top" class="even"><td>commercial.pri</td><td>Projects and themes that are only in commercial Qtopia source packages.</td></tr>
<tr valign="top" class="odd"><td>custom.pri</td><td>Overrides/additions for Qtopia.</td></tr>
<tr valign="top" class="even"><td>desktop.pri</td><td>Projects that are in Qtopia Desktop.</td></tr>
<tr valign="top" class="odd"><td>custom_qd.pri</td><td>Overrides/additions for Qtopia Desktop.</td></tr>
</table></p>
<p>The following files are included from <tt>src</tt> in the build tree:</p>
<p><table width="100%" align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>File</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td>local.pri</td><td>Overrides/additions specific to a build.</td></tr>
<tr valign="top" class="even"><td>local_qd.pri</td><td>Overrides/additions for Qtopia Desktop specific to a build.</td></tr>
</table></p>
<p>It is not recommended to modify <tt>general.pri</tt> and <tt>commercial.pri</tt>, instead you should use <tt>custom.pri</tt> and <tt>local.pri</tt>. The intent is for <i>organization</i> changes (that is, changes that will be part of a redistributed source package) to go into <tt>custom.pri</tt> and changes for individual developers to go into <tt>local.pri</tt>.</p>
<p>When adding projects, it is recommended to use <tt>*=</tt> to avoid the possibility of duplicate entries as duplicate entries can cause problems when you try to build. For example:</p>
<pre>    PROJECTS+=myproj
    PROJECTS*=myproj # no duplicate
    PROJECTS+=myproj # duplicate</pre>
<p>A project can be removed using <tt>-=</tt> as follows:</p>
<pre>    PROJECTS-=myproj</pre>
<p><b>Note:</b> <tt>qmake</tt> does not consider it an error to remove a non-existent value so check for spelling errors if a removed project is still building.</p>
<p><tt>CONFIG</tt> values that are set based on edition and configuration can be used when adding projects, for example, a PDA-specific application could be added with:</p>
<pre>    pda:PROJECTS*=myproj</pre>
<p>In the situation where You might want to enable a project only if another project is enabled, you can check for the presence of a project with the <tt>qmake</tt> <tt>contains</tt> function as follows:</p>
<pre>    contains(PROJECTS,applications/mygreatapp):PROJECTS*=plugins/mygreatapp/time</pre>
<a name="common-makefile-targets"></a>
<h2>Common Makefile Targets</h2>
<p>The following targets should work everywhere and will descend into subdirectories unless otherwise noted:</p>
<p><table width="100%" align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Target</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td><tt>all</tt></td><td>Build the target.</td></tr>
<tr valign="top" class="even"><td><tt>first</tt></td><td>Same as <tt>all</tt>. Provided for compatibility with Qt (which uses <tt>all</tt> to mean both debug and release versions).</td></tr>
<tr valign="top" class="odd"><td><tt>install</tt></td><td>Run the install rules.</td></tr>
<tr valign="top" class="even"><td><tt>install_target</tt></td><td>Install the target only (eg. the application binary).</td></tr>
<tr valign="top" class="odd"><td><tt>cleaninstall</tt></td><td>Remove the <tt>image</tt> (and <tt>dimage</tt>) directories before installing. (Only useful when used from the top of the tree).</td></tr>
<tr valign="top" class="even"><td><tt>lupdate</tt></td><td>Update <tt>.ts</tt> files.</td></tr>
<tr valign="top" class="odd"><td><tt>syncqtopia</tt></td><td><ul>
<li>Install Headers. See <a href="#setting-up-headers">Setting Up Headers</a> for details.</li>
<li>Only libraries will be processed.</li>
</ul>
</td></tr>
<tr valign="top" class="even"><td><tt>packages</tt></td><td>Make installable packages. See <a href="#packages">Packages</a> for details.</td></tr>
<tr valign="top" class="odd"><td><tt>sdk</tt></td><td>Run the SDK rules.</td></tr>
<tr valign="top" class="even"><td><tt>devsdk</tt></td><td>Run the <a href="buildsystem-reference.html#devsdk">DevSDK</a> rules.</td></tr>
<tr valign="top" class="odd"><td><tt>regenerate</tt></td><td>Rebuild the Makefile for this project. Do not descend into subdirectories.</td></tr>
<tr valign="top" class="even"><td><tt>qmake</tt></td><td>Same as <tt>regenerate</tt> but descends into subdirectories.</td></tr>
<tr valign="top" class="odd"><td><tt>qmake-debug</tt></td><td>Same as <tt>regenerate</tt> but turns on <tt>qmake</tt> debugging.</td></tr>
<tr valign="top" class="even"><td><tt>clean</tt></td><td>Remove intermediate files (not everything).</td></tr>
<tr valign="top" class="odd"><td><tt>disclean</tt></td><td>Remove the target and <tt>Makefile.target</tt>.</td></tr>
<tr valign="top" class="even"><td><tt>remove_target</tt></td><td>Remove the target so that <tt>make</tt> will cause it to be re-linked.</td></tr>
<tr valign="top" class="odd"><td><tt>relink</tt></td><td>Runs <tt>make remove_target</tt> and <tt>make</tt> so that all targets are re-linked.</td></tr>
</table></p>
<a name="devconfigprofiles"></a><a name="device-configuration-profiles"></a>
<h2>Device Configuration Profiles</h2>
<p>Device Configuration Profiles simplify the task of configuring Qtopia for a device. A single directory contains all of the configuration information required to build for the device. The profiles are located in the <tt>devices</tt> directory in the source tree and are activated by running:</p>
<pre>    configure -device foo</pre>
<p>For a tutorial on the process of implementing a plug-in for a new device see : <a href="tut-deviceexample.html">Tutorial: Implementing a Device Plug-in</a></p>
<p>The following sections describe how to customize the profiles:</p>
<a name="features"></a>
<h2>Features</h2>
<p>Each feature of the Device Configuration Profiles is identified by the file that implements it.</p>
<a name="configure"></a>
<h3>configure</h3>
<p>Each device configuration profile can have a file named <tt>configure</tt> that specifies all the arguments required to configure for the new device. This simplifies the process as generally many configuration arguments are required.</p>
<p>When <tt>configure ... -device foo ...</tt> is run, <tt>configure</tt> checks for <tt>$QTOPIA_DEPOT_PATH/devices/device/configure</tt> and if it is found, <tt>configure</tt> re-launches itself with <tt>-device device</tt> replaced by the contents of the file.</p>
<p>The following is a sample configure file:</p>
<pre>    -edition phone -xplatform mydev -arch arm -no-qvfb
    -release -displaysize 240x320 -quicklaunch
    -defaultbuttons phone
    -extra-qtopiacore-config -plugin-kbd-mydev
    -extra-qtopiacore-config -plugin-mouse-mydev
    -prefix /opt/Qtopia</pre>
<p><b>Note:</b></p>
<ol type="1">
<li>Whitespace is interpreted by the shell so the newlines are not relevant.</li>
<li>The ordering of arguments is significant. Anything specified before <tt>-device</tt> can be overridden by the device profile while anything after <tt>-device</tt> can override the device profile.</li>
</ol>
<p>For example, the sample file above specifies <tt>-release</tt>. Here is what would happen <tt>-debug</tt> is passed before and after <tt>-device foo</tt>:</p>
<ul>
<li>Before:<pre>    {configure -debug -device foo}</pre>
<p>becomes:</p>
<pre>    {configure -debug -release}</pre>
<p><tt>-release</tt> overrides <tt>-debug</tt> so a release build is performed.</p>
</li>
<li>After:<pre>    {configure -device foo -debug}</pre>
<p>becomes:</p>
<pre>    {configure -release -debug}</pre>
<p><tt>-debug</tt> overrides <tt>-release</tt> so a debug build is performed.</p>
</li>
</ul>
<a name="environment"></a>
<h3>environment</h3>
<p>The <tt>environment</tt> script (if it exists) is sourced before re-running <tt>configure</tt> and before <tt>Makefile</tt> calls <tt>Makefile.target</tt>. The suggested use is to set up paths to an appropriate compiler with the <tt>DEVICE_CONFIG_PATH</tt> variable set to the path of the device configuration profile so that files inside the device directory can be located.</p>
<a name="mkspecs"></a>
<h3>mkspecs</h3>
<p>A typical behavior of the <tt>configure</tt> file is to set <tt>-xplatform</tt> so it is useful to have a platform specification for the device. Profiles can contain a <tt>mkspecs</tt> directory that is used to determine <tt>-platform</tt> and <tt>-xplatform</tt> speciification files. This allows a device to be built without having to modify the Qt depot (although it is possible to move a specification file to Qt without having to modify the configure line).</p>
<p>For example, the <tt>mydev</tt> specification files are in its configuration directory as follows:</p>
<pre>    devices/mydev/mkspecs/qws/linux-mydev-g++/qmake.conf
    devices/mydev/mkspecs/qws/linux-mydev-g++/qplatformdefs.h</pre>
<p>There are <tt>mkspecs</tt> that ship with Qtopia Core located in <tt>qtopiacore/qt/mkspecs/qws</tt>. You should copy one that is similar to your device, for example, <tt>linux-arm-g++</tt>, and modify it to suit your device. Be sure to check the compiler name and the compiler flags (especially optimization flags). You may also want the <tt>mkspec</tt> to specify a <tt>define</tt> to be used to enable device-specific code in Qtopia Core and Qtopia.</p>
<a name="custom-h-custom-cpp"></a>
<h3>custom.h/custom.cpp</h3>
<p>These files are device-specific and it is useful for them to be included in the Device Configuration Profile. If they are not present, <tt>configure</tt> will look in the traditional location, <tt>$QTOPIA_DEPOT_PATH/src/libraries/qtopia/custom-$xplatform.(h|cpp)</tt>. See <a href="syscust-hardware.html">Hardware Configuration</a> for information about <tt>custom.h</tt>.</p>
<a name="defaultbuttons-conf"></a>
<h3>defaultbuttons.conf</h3>
<p>Every device needs a suitable <tt>defaultbuttons.conf</tt>, However, use of this file <b>only</b> occurs if <tt>-defaultbuttons</tt> is not passed to <tt>configure</tt>. Refer to: <a href="syscust-keypadbutt.html">Keypad Button Behavior</a> for a description of <tt>defaultbuttons.conf</tt>.</p>
<a name="config-pri"></a>
<h3>config.pri</h3>
<p>Configuration tweaks can be done here. This is read just after the configure-generated config.pri, before each .pro file is read. A modified <tt>config.pri</tt> file is used to customize configuration. This file is read after the the <tt>config.pri</tt> file generated by <tt>configure</tt> and before each <tt>.pro</tt> file. Adding &lt;content&gt; to a <tt>config.pri</tt> file is equivalent to running the following:</p>
<pre>    configure -config &lt;content&gt;</pre>
<a name="projects-pri"></a>
<h3>projects.pri</h3>
<p>The <tt>projects.pri</tt> file is used to enable and disable projects for a device. It is processed after <tt>general.pri</tt> and <tt>commercial.pri</tt> but before <tt>custom.pri</tt> and <tt>local.pri</tt> so that the user can still override the projects.</p>
<a name="src"></a>
<h3>src</h3>
<p>If the src directory exists, it is added as a project root that is:</p>
<pre>        configure -build $QTOPIA_DEPOT_PATH/devices/foo/src}</pre>
<p>It is recommended to mimic the Qtopia source tree layout for ease of reference.</p>
<a name="qconfig-h"></a>
<h3>qconfig.h</h3>
<p>This file overrides the use of <tt>qconfig-qpe.h</tt>. It can define all new items or can include and override settings by using:</p>
<pre>        #include &quot;qconfig-qpe.h&quot;</pre>
<p><b>Note:</b> Beware of dependencies when including and overriding.</p>
<a name="storage-conf"></a>
<h3>Storage.conf</h3>
<p>This file defined the storage locations on a Qtopia device. See <a href="syscust-docstorage.html">Document Storage</a> for details.</p>
<a name="limitations"></a>
<h3>Limitations</h3>
<p>Profiles do not currently function with the following:</p>
<ul>
<li>Applying device-specific patches to existing sources.</li>
<li>Device-specific files for Helix.</li>
</ul>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2007 <a href="trolltech.html">Trolltech</a></td>
<td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">Qtopia 4.2.1</div></td>
</tr></table></div></address></body>
</html>
